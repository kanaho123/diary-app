<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‰ªäÊó•„ÅÆÊó•Ë®ò - v0.0.8</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Hiragino Sans', 'Yu Gothic', 'Meiryo', sans-serif;
            background: #f5f5f5;
            line-height: 1.6;
            color: #333;
            padding-bottom: 80px;
        }

        /* „É≠„Ç∞„Ç§„É≥ÁîªÈù¢ */
        .login-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .login-overlay.hidden {
            display: none;
        }

        .login-box {
            background: white;
            border-radius: 20px;
            padding: 40px 30px;
            max-width: 400px;
            width: 90%;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            text-align: center;
        }

        .login-box h1 {
            font-size: 24px;
            margin-bottom: 10px;
            color: #333;
        }

        .login-box p {
            font-size: 14px;
            color: #666;
            margin-bottom: 30px;
            line-height: 1.8;
        }

        /* „Ç®„É©„Éº„É°„ÉÉ„Çª„Éº„Ç∏ */
        .error-message {
            background: #fff5f5;
            border: 2px solid #ff6b6b;
            color: #c92a2a;
            padding: 12px 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            font-size: 14px;
            display: none;
            text-align: left;
            line-height: 1.5;
        }

        .error-message.show {
            display: block;
        }

        /* „Ç∞„É≠„Éº„Éê„É´„Ç®„É©„ÉºË°®Á§∫ */
        .global-error {
            position: fixed;
            top: 140px;
            left: 50%;
            transform: translateX(-50%);
            background: #fff5f5;
            border: 2px solid #ff6b6b;
            color: #c92a2a;
            padding: 15px 20px;
            border-radius: 12px;
            font-size: 14px;
            max-width: 90%;
            width: 500px;
            z-index: 1001;
            display: none;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .global-error.show {
            display: block;
            animation: slideDown 0.3s ease;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateX(-50%) translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(-50%) translateY(0);
            }
        }

        .login-input {
            width: 100%;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            font-size: 16px;
            margin-bottom: 15px;
            transition: all 0.3s;
        }

        .login-input:focus {
            outline: none;
            border-color: #667eea;
            background: #fafbff;
        }

        .login-input:disabled {
            background: #f5f5f5;
            color: #999;
        }

        .login-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .login-tab {
            flex: 1;
            padding: 10px;
            background: #f0f0f0;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }

        .login-tab.active {
            background: #667eea;
            color: white;
        }

        .login-form {
            display: none;
        }

        .login-form.active {
            display: block;
        }

        .login-btn {
            width: 100%;
            padding: 16px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .login-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.4);
        }

        .login-btn:active {
            transform: translateY(0);
        }

        .login-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .login-link {
            margin-top: 15px;
            font-size: 13px;
            color: #667eea;
            cursor: pointer;
            text-decoration: underline;
        }

        .returning-user-info {
            background: #e8ecff;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: left;
        }

        .returning-user-info strong {
            color: #667eea;
        }

        /* ÁÆ°ÁêÜËÄÖ„Éë„Éç„É´ */
        .admin-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            overflow-y: auto;
        }

        .admin-overlay.show {
            display: flex;
        }

        .admin-panel {
            background: white;
            border-radius: 20px;
            padding: 30px;
            max-width: 900px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            margin: 20px;
        }

        .admin-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e0e0e0;
        }

        .admin-header h2 {
            font-size: 24px;
            color: #333;
        }

        .admin-close-btn {
            background: #ff6b6b;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
        }

        .admin-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .admin-search {
            flex: 1;
            min-width: 200px;
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
        }

        .admin-btn {
            padding: 10px 20px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            white-space: nowrap;
        }

        .admin-diary-item {
            background: #f9f9f9;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            border: 1px solid #e0e0e0;
        }

        .admin-diary-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            padding-bottom: 10px;
            border-bottom: 1px solid #e0e0e0;
        }

        .admin-diary-info {
            font-size: 13px;
            color: #666;
        }

        .admin-diary-content {
            font-size: 14px;
            color: #333;
            line-height: 1.6;
        }

        .admin-diary-field {
            margin-bottom: 8px;
        }

        .admin-diary-label {
            font-weight: 600;
            color: #667eea;
            margin-right: 5px;
        }

        /* „Éò„ÉÉ„ÉÄ„Éº */
        .header {
            background: white;
            padding: 20px;
            text-align: center;
            border-bottom: 1px solid #e0e0e0;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header h1 {
            font-size: 20px;
            font-weight: 600;
            color: #333;
            cursor: pointer;
            user-select: none;
        }

        .header p {
            font-size: 13px;
            color: #888;
            margin-top: 5px;
        }

        .header-user {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 600px;
            margin: 10px auto 0;
        }

        .user-info {
            font-size: 13px;
            color: #667eea;
            font-weight: 500;
        }

        .logout-btn {
            background: none;
            border: 1px solid #e0e0e0;
            padding: 5px 12px;
            border-radius: 6px;
            font-size: 12px;
            color: #888;
            cursor: pointer;
            transition: all 0.3s;
        }

        .logout-btn:hover {
            background: #f5f5f5;
        }

        /* „Éê„Éº„Ç∏„Éß„É≥Ë°®Á§∫ */
        .version-badge {
            position: absolute;
            top: 20px;
            right: 20px;
            background: #f0f0f0;
            color: #888;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 500;
        }

        /* „Éä„Éì„Ç≤„Éº„Ç∑„Éß„É≥ */
        .nav {
            background: white;
            display: flex;
            border-bottom: 1px solid #e0e0e0;
            position: sticky;
            top: 120px;
            z-index: 99;
        }

        .nav-btn {
            flex: 1;
            padding: 15px;
            background: none;
            border: none;
            font-size: 15px;
            cursor: pointer;
            color: #888;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
        }

        .nav-btn.active {
            color: #667eea;
            border-bottom-color: #667eea;
            font-weight: 600;
        }

        /* „Ç≥„É≥„ÉÜ„Éä */
        .container {
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
        }

        .page {
            display: none;
        }

        .page.active {
            display: block;
        }

        /* Ë≥™Âïè„Ç´„Éº„Éâ */
        .question-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .question-label {
            display: block;
            font-size: 15px;
            color: #333;
            margin-bottom: 10px;
            font-weight: 500;
        }

        .required-badge {
            display: inline-block;
            background: #ff6b6b;
            color: white;
            font-size: 11px;
            padding: 2px 8px;
            border-radius: 4px;
            margin-left: 8px;
        }

        .optional-badge {
            display: inline-block;
            background: #e0e0e0;
            color: #666;
            font-size: 11px;
            padding: 2px 8px;
            border-radius: 4px;
            margin-left: 8px;
        }

        textarea, input[type="text"], input[type="password"] {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 15px;
            font-family: inherit;
            resize: vertical;
            min-height: 60px;
            transition: all 0.3s;
        }

        input[type="text"], input[type="password"] {
            min-height: auto;
        }

        textarea:focus, input[type="text"]:focus, input[type="password"]:focus {
            outline: none;
            border-color: #667eea;
            background: #fafbff;
        }

        /* Ê∞óÂàÜ„Çø„Ç∞ */
        .mood-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 10px;
        }

        .mood-tag {
            padding: 8px 16px;
            background: #f5f5f5;
            border: 2px solid #e0e0e0;
            border-radius: 20px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .mood-tag:hover {
            background: #e8ecff;
        }

        .mood-tag.selected {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        /* Êäò„Çä„Åü„Åü„Åø„Çª„ÇØ„Ç∑„Éß„É≥ */
        .collapsible-section {
            background: white;
            border-radius: 12px;
            margin-bottom: 15px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .section-header {
            padding: 18px 20px;
            background: #fafafa;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            user-select: none;
        }

        .section-header:active {
            background: #f0f0f0;
        }

        .section-title {
            font-size: 15px;
            font-weight: 600;
            color: #333;
        }

        .section-subtitle {
            font-size: 13px;
            color: #888;
            margin-top: 3px;
        }

        .section-arrow {
            font-size: 20px;
            color: #888;
            transition: transform 0.3s;
        }

        .section-header.expanded .section-arrow {
            transform: rotate(180deg);
        }

        .section-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }

        .section-content.expanded {
            max-height: 5000px;
        }

        .section-inner {
            padding: 20px;
        }

        /* ÂÄãÂà•Ë≥™Âïè„ÅÆÊäò„Çä„Åü„Åü„Åø */
        .question-item {
            border-bottom: 1px solid #f0f0f0;
            padding: 15px 0;
        }

        .question-item:last-child {
            border-bottom: none;
        }

        .question-toggle {
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            padding: 5px 0;
        }

        .question-text {
            font-size: 14px;
            color: #555;
            flex: 1;
        }

        .favorite-btn {
            background: none;
            border: none;
            font-size: 18px;
            cursor: pointer;
            padding: 5px;
            margin-right: 10px;
        }

        .question-arrow {
            font-size: 18px;
            color: #ccc;
            transition: transform 0.3s;
        }

        .question-toggle.expanded .question-arrow {
            transform: rotate(180deg);
        }

        .question-input-area {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }

        .question-input-area.expanded {
            max-height: 500px;
            margin-top: 10px;
        }

        /* ÂÖ¨ÈñãË®≠ÂÆö */
        .privacy-controls {
            display: flex;
            gap: 15px;
            margin-top: 10px;
            padding: 10px;
            background: #f9f9f9;
            border-radius: 8px;
            font-size: 13px;
        }

        .privacy-checkbox {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .privacy-checkbox input[type="checkbox"] {
            width: auto;
            height: auto;
            min-height: auto;
            cursor: pointer;
        }

        .privacy-checkbox label {
            cursor: pointer;
            color: #666;
        }

        /* „Éú„Çø„É≥ */
        .btn {
            width: 100%;
            padding: 16px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:active {
            transform: scale(0.98);
        }

        .save-btn-container {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            padding: 15px 20px;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
            z-index: 100;
        }

        /* „Éï„Ç£„Éº„Éâ */
        .feed-zone-selector {
            background: white;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 15px;
            display: flex;
            gap: 10px;
        }

        .zone-btn {
            flex: 1;
            padding: 12px;
            background: #f5f5f5;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s;
        }

        .zone-btn.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .feed-item {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .feed-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #f0f0f0;
        }

        .feed-author {
            font-size: 14px;
            color: #888;
        }

        .feed-date {
            font-size: 13px;
            color: #aaa;
        }

        .feed-content {
            margin-bottom: 15px;
        }

        .feed-question {
            margin-bottom: 12px;
        }

        .feed-question-title {
            font-size: 13px;
            color: #888;
            margin-bottom: 5px;
        }

        .feed-question-answer {
            font-size: 15px;
            color: #333;
            line-height: 1.6;
        }

        .feed-reactions {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            padding-top: 10px;
            border-top: 1px solid #f0f0f0;
        }

        .reaction-btn {
            padding: 8px 14px;
            background: #f5f5f5;
            border: none;
            border-radius: 20px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .reaction-btn:hover {
            background: #e8ecff;
        }

        .reaction-btn.sent {
            background: #667eea;
            color: white;
        }

        /* „É™„Ç¢„ÇØ„Ç∑„Éß„É≥Êï∞Ë°®Á§∫ */
        .reaction-count {
            background: #fff;
            color: #667eea;
            border: 1px solid #667eea;
            padding: 2px 6px;
            border-radius: 10px;
            font-size: 12px;
            font-weight: 600;
            margin-left: 3px;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #999;
        }

        .empty-state-icon {
            font-size: 48px;
            margin-bottom: 15px;
        }

        .empty-state-text {
            font-size: 15px;
            line-height: 1.8;
        }

        /* „É©„É≥„ÉÄ„É†Ë≥™Âïè„Ç´„Éº„Éâ */
        .random-question-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            border: 1px solid #e8e8e8;
        }

        .random-question-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 10px;
        }

        .random-question-title {
            font-size: 14px;
            font-weight: 500;
            color: #666;
        }

        .random-question-text-display {
            font-size: 15px;
            color: #333;
            margin-bottom: 12px;
            line-height: 1.5;
        }

        /* „ÅäÊ∞ó„Å´ÂÖ•„ÇäË≥™Âïè */
        .favorite-questions {
            background: #fffbf0;
            border: 2px solid #ffe4a3;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
        }

        .favorite-title {
            font-size: 15px;
            font-weight: 600;
            color: #d4a500;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        /* ÊàêÂäü„É°„ÉÉ„Çª„Éº„Ç∏ */
        .success-message {
            background: #d4edda;
            color: #155724;
            padding: 15px 20px;
            border-radius: 8px;
            margin-bottom: 15px;
            display: none;
            align-items: center;
            gap: 10px;
        }

        .success-message.show {
            display: flex;
        }

        /* Ëá™ÂàÜ„ÅÆÊó•Ë®ò‰∏ÄË¶ß */
        .my-diary-item {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .my-diary-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
            padding-bottom: 10px;
            border-bottom: 1px solid #f0f0f0;
        }

        .my-diary-date {
            font-size: 14px;
            font-weight: 600;
            color: #667eea;
        }

        .my-diary-mood {
            font-size: 13px;
            color: #888;
        }

        .my-diary-content {
            margin-bottom: 10px;
        }

        .my-diary-question {
            margin-bottom: 10px;
        }

        .my-diary-question-title {
            font-size: 12px;
            color: #999;
            margin-bottom: 3px;
        }

        .my-diary-question-answer {
            font-size: 14px;
            color: #555;
            line-height: 1.5;
        }

        .delete-diary-btn {
            margin-top: 10px;
            padding: 8px 16px;
            background: #ff6b6b;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .delete-diary-btn:hover {
            background: #ff5252;
        }

        /* „Éû„Ç§„Éö„Éº„Ç∏ÔºàÂèãÈÅî„Ç≥„Éº„ÉâÔºâ */
        .profile-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .profile-card h3 {
            font-size: 16px;
            margin-bottom: 15px;
            color: #333;
        }

        .friend-code-display {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            margin-bottom: 15px;
        }

        .friend-code-label {
            font-size: 13px;
            opacity: 0.9;
            margin-bottom: 8px;
        }

        .friend-code-value {
            font-size: 28px;
            font-weight: bold;
            letter-spacing: 4px;
            font-family: 'Courier New', monospace;
        }

        .friend-code-input-area {
            margin-top: 20px;
        }

        .friend-code-input-area label {
            display: block;
            font-size: 14px;
            margin-bottom: 8px;
            color: #666;
        }

        .friend-input-group {
            display: flex;
            gap: 10px;
        }

        .friend-input-group input {
            flex: 1;
        }

        .friend-input-group button {
            padding: 12px 20px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            white-space: nowrap;
        }

        /* ÂèçÂøú„É™„Çπ„Éà */
        .reaction-list {
            margin-top: 10px;
        }

        .reaction-item {
            background: #f9f9f9;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .reaction-type {
            font-weight: 600;
            color: #667eea;
        }

        .reaction-time {
            font-size: 12px;
            color: #999;
            margin-left: 10px;
        }

        .reaction-entry-info {
            font-size: 12px;
            color: #aaa;
            margin-top: 5px;
        }

        /* Êõ¥Êñ∞Â±•Ê≠¥ */
        .changelog-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .changelog-card h3 {
            font-size: 16px;
            margin-bottom: 15px;
            color: #333;
        }

        .changelog-item {
            padding: 12px 0;
            border-bottom: 1px solid #f0f0f0;
        }

        .changelog-item:last-child {
            border-bottom: none;
        }

        .changelog-version {
            font-size: 13px;
            font-weight: 600;
            color: #667eea;
            margin-bottom: 3px;
        }

        .changelog-date {
            font-size: 12px;
            color: #aaa;
            margin-left: 8px;
        }

        .changelog-description {
            font-size: 14px;
            color: #666;
            line-height: 1.5;
        }

        /* „É¨„Çπ„Éù„É≥„Ç∑„Éñ */
        @media (max-width: 480px) {
            .container {
                padding: 15px;
            }

            .question-card, .collapsible-section {
                border-radius: 8px;
            }

            .version-badge {
                top: 10px;
                right: 10px;
                font-size: 10px;
                padding: 3px 8px;
            }
        }
    </style>
</head>
<body>
    <!-- „Ç∞„É≠„Éº„Éê„É´„Ç®„É©„ÉºË°®Á§∫ -->
    <div class="global-error" id="globalError"></div>

    <!-- „É≠„Ç∞„Ç§„É≥ÁîªÈù¢ -->
    <div class="login-overlay" id="loginOverlay">
        <div class="login-box">
            <h1>üìñ ‰ªäÊó•„ÅÆÊó•Ë®ò</h1>
            <p id="loginMessage">„Éã„ÉÉ„ÇØ„Éç„Éº„É†„Å®PIN„Åß<br>„É≠„Ç∞„Ç§„É≥„Åæ„Åü„ÅØÊñ∞Ë¶èÁôªÈå≤„Åó„Å¶„Åè„Å†„Åï„ÅÑ</p>
            
            <!-- „Ç®„É©„Éº„É°„ÉÉ„Çª„Éº„Ç∏Ë°®Á§∫„Ç®„É™„Ç¢ -->
            <div class="error-message" id="loginError"></div>
            
            <div class="login-tabs" id="loginTabs">
                <button class="login-tab active" onclick="switchLoginTab('login')">„É≠„Ç∞„Ç§„É≥</button>
                <button class="login-tab" onclick="switchLoginTab('register')">Êñ∞Ë¶èÁôªÈå≤</button>
            </div>

            <!-- Á∞°Êòì„É≠„Ç∞„Ç§„É≥„Éï„Ç©„Éº„É†Ôºà„É™„Éî„Éº„Çø„ÉºÁî®Ôºâ -->
            <div id="quickLoginForm" class="login-form">
                <div class="returning-user-info">
                    <strong>„Åä„Åã„Åà„Çä„Å™„Åï„ÅÑÔºÅ</strong><br>
                    <span id="returningNickname"></span>
                </div>
                <input type="password" class="login-input" id="quickLoginPin" placeholder="4Ê°ÅPIN„ÇíÂÖ•Âäõ" maxlength="4" pattern="[0-9]{4}">
                <button class="login-btn" onclick="quickLogin()">„É≠„Ç∞„Ç§„É≥</button>
                <div class="login-link" onclick="switchToFullLogin()">Âà•„ÅÆ„Ç¢„Ç´„Ç¶„É≥„Éà„Åß„É≠„Ç∞„Ç§„É≥</div>
            </div>

            <!-- ÈÄöÂ∏∏„É≠„Ç∞„Ç§„É≥„Éï„Ç©„Éº„É† -->
            <div id="loginForm" class="login-form">
                <input type="text" class="login-input" id="loginNickname" placeholder="„Éã„ÉÉ„ÇØ„Éç„Éº„É†" maxlength="20">
                <input type="password" class="login-input" id="loginPin" placeholder="4Ê°ÅPIN" maxlength="4" pattern="[0-9]{4}">
                <button class="login-btn" onclick="login()">„É≠„Ç∞„Ç§„É≥</button>
            </div>

            <!-- Êñ∞Ë¶èÁôªÈå≤„Éï„Ç©„Éº„É† -->
            <div id="registerForm" class="login-form">
                <input type="text" class="login-input" id="registerNickname" placeholder="„Éã„ÉÉ„ÇØ„Éç„Éº„É†" maxlength="20">
                <input type="password" class="login-input" id="registerPin" placeholder="4Ê°ÅPIN(Êï∞Â≠ó„ÅÆ„Åø)" maxlength="4" pattern="[0-9]{4}">
                <input type="password" class="login-input" id="registerPinConfirm" placeholder="PINÁ¢∫Ë™ç" maxlength="4" pattern="[0-9]{4}">
                <button class="login-btn" onclick="register()">ÁôªÈå≤</button>
            </div>
        </div>
    </div>

    <!-- ÁÆ°ÁêÜËÄÖ„Éë„Éç„É´ -->
    <div class="admin-overlay" id="adminOverlay">
        <div class="admin-panel">
            <div class="admin-header">
                <h2>üîê ÁÆ°ÁêÜËÄÖ„Éë„Éç„É´</h2>
                <button class="admin-close-btn" onclick="closeAdminPanel()">Èñâ„Åò„Çã</button>
            </div>

            <div class="admin-controls">
                <input type="text" class="admin-search" id="adminSearchNickname" placeholder="„Éã„ÉÉ„ÇØ„Éç„Éº„É†„ÅßÊ§úÁ¥¢" onkeyup="filterAdminDiaries()">
                <input type="date" class="admin-search" id="adminSearchDate" onchange="filterAdminDiaries()">
                <button class="admin-btn" onclick="exportCSV()">üì• CSVÂá∫Âäõ</button>
            </div>

            <div id="adminDiariesContent"></div>
        </div>
    </div>

    <!-- „Éò„ÉÉ„ÉÄ„Éº -->
    <div class="header">
        <div class="version-badge" id="versionBadge">v0.0.8</div>
        <h1 id="headerTitle" onclick="handleTitleTap()">üìñ ‰ªäÊó•„ÅÆÊó•Ë®ò</h1>
        <p id="headerSubtitle">‰ªäÊó•„ÇÇ„Åä„Å§„Åã„Çå„Åï„Åæ„Åß„Åô</p>
        <div class="header-user">
            <span class="user-info" id="userInfo"></span>
            <button class="logout-btn" onclick="logout()">„É≠„Ç∞„Ç¢„Ç¶„Éà</button>
        </div>
    </div>

    <!-- „Éä„Éì„Ç≤„Éº„Ç∑„Éß„É≥ -->
    <div class="nav">
        <button class="nav-btn active" onclick="switchPage('write')">Êõ∏„Åè</button>
        <button class="nav-btn" onclick="switchPage('profile')" id="profileNavBtn">„Éû„Ç§„Éö„Éº„Ç∏</button>
        <button class="nav-btn" onclick="switchPage('my')" id="myNavBtn">Ëá™ÂàÜ„ÅÆÊó•Ë®ò</button>
        <button class="nav-btn" onclick="switchPage('feed')" id="feedNavBtn">„Åø„Çì„Å™„ÅÆÊó•Ë®ò</button>
    </div>

    <!-- „Ç≥„É≥„ÉÜ„Éä -->
    <div class="container">
        <!-- Êõ∏„Åè„Éö„Éº„Ç∏ -->
        <div id="writePage" class="page active">
            <!-- ÊàêÂäü„É°„ÉÉ„Çª„Éº„Ç∏ -->
            <div class="success-message" id="successMessage">
                <span>‚úÖ</span>
                <span id="successMessageText">Êó•Ë®ò„Çí‰øùÂ≠ò„Åó„Åæ„Åó„Åü!</span>
            </div>

            <!-- ÂøÖÈ†àË≥™Âïè -->
            <div class="question-card">
                <label class="question-label">
                    Q1: ‰ªä„ÅÆÊ∞óÂàÜ„ÅØ?<span class="required-badge">ÂøÖÈ†à</span>
                </label>
                <input type="text" id="mood" placeholder="‰∏ÄË®Ä„ÅßË°®„Åô„Å®..." />
                <div class="mood-tags">
                    <div class="mood-tag" onclick="selectMood(this, 'üòä „Çà„ÅÑ')">üòä „Çà„ÅÑ</div>
                    <div class="mood-tag" onclick="selectMood(this, 'üòå „Åæ„ÅÇ„Åæ„ÅÇ')">üòå „Åæ„ÅÇ„Åæ„ÅÇ</div>
                    <div class="mood-tag" onclick="selectMood(this, 'üòê „Åµ„Å§„ÅÜ')">üòê „Åµ„Å§„ÅÜ</div>
                    <div class="mood-tag" onclick="selectMood(this, 'üòî „Åó„Çì„Å©„ÅÑ')">üòî „Åó„Çì„Å©„ÅÑ</div>
                    <div class="mood-tag" onclick="selectMood(this, 'üò§ „É¢„É§„É¢„É§')">üò§ „É¢„É§„É¢„É§</div>
                    <div class="mood-tag" onclick="selectMood(this, 'ü§î „Çà„Åè„Çè„Åã„Çâ„Çì')">ü§î „Çà„Åè„Çè„Åã„Çâ„Çì</div>
                </div>
            </div>

            <div class="question-card">
                <label class="question-label">
                    Q2: ‰ªäÊó•„ÅÑ„Å°„Å∞„ÇìÊÆã„Åó„Åü„ÅÑ„Åì„Å®„ÅØ?<span class="required-badge">ÂøÖÈ†à</span>
                </label>
                <textarea id="memorable" placeholder="ËâØ„ÅÑ„Åì„Å®„ÄÅÊÇ™„ÅÑ„Åì„Å®„ÄÅ„Å©„ÅÜ„Åß„ÇÇ„ÅÑ„ÅÑ„Åì„Å®„ÄÅ„Å™„Çì„Åß„ÇÇOK"></textarea>
            </div>

            <div class="question-card">
                <label class="question-label">
                    Q3: ‰ªäÊó•„ÅÆËá™ÂàÜ„Å´‰∏ÄË®Ä<span class="required-badge">ÂøÖÈ†à</span>
                </label>
                <textarea id="selfTalk" placeholder="Ë§í„ÇÅ„ÄÅ„Å≠„Åé„Çâ„ÅÑ„ÄÅ„ÉÑ„ÉÉ„Ç≥„Éü„ÄÅ„Å™„Çì„Åß„ÇÇOK"></textarea>
            </div>

            <!-- „ÅäÊ∞ó„Å´ÂÖ•„ÇäË≥™Âïè -->
            <div class="favorite-questions" id="favoriteSection" style="display: none;">
                <div class="favorite-title">‚≠ê „Çà„ÅèÊõ∏„ÅèË≥™Âïè</div>
                <div id="favoriteQuestionsList"></div>
            </div>

            <!-- „É©„É≥„ÉÄ„É†Ë≥™Âïè -->
            <div class="random-question-card">
                <div class="random-question-header">
                    <span class="random-question-title">üìã ÊØéÊó•„É©„É≥„ÉÄ„É†Ë≥™Âïè</span>
                    <span class="optional-badge">‰ªªÊÑè</span>
                </div>
                <div class="random-question-text-display" id="randomQuestionText"></div>
                <textarea id="randomAnswer" placeholder="Á≠î„Åà„Å¶„Åø„Çã(‰ªªÊÑè)"></textarea>
                <div class="privacy-controls">
                    <div class="privacy-checkbox">
                        <input type="checkbox" id="randomPublic">
                        <label for="randomPublic">ÂÖ¨Èñã„Åô„Çã</label>
                    </div>
                    <div class="privacy-checkbox">
                        <input type="checkbox" id="randomAnonymous">
                        <label for="randomAnonymous">ÂåøÂêç„ÅßÂÖ¨Èñã</label>
                    </div>
                </div>
            </div>

            <!-- ‰ªªÊÑèË≥™ÂïèÔºà„ÇØ„Ç§„ÉÉ„ÇØÔºâ -->
            <div class="collapsible-section">
                <div class="section-header" onclick="toggleSection(this)">
                    <div>
                        <div class="section-title">„Åï„Å£„Å®Êõ∏„Åç„Åü„ÅÑ‰∫∫„Å†„Åë</div>
                        <div class="section-subtitle">Ê∞óËªΩ„Å´Êõ∏„Åë„ÇãË≥™Âïè„Åü„Å°</div>
                    </div>
                    <span class="section-arrow">‚ñº</span>
                </div>
                <div class="section-content">
                    <div class="section-inner" id="quickQuestions"></div>
                </div>
            </div>

            <!-- ‰ªªÊÑèË≥™ÂïèÔºà„Éá„Ç£„Éº„ÉóÔºâ -->
            <div class="collapsible-section">
                <div class="section-header" onclick="toggleSection(this)">
                    <div>
                        <div class="section-title">„Å°„Çá„Å£„Å®ËÄÉ„Åà„Åü„ÅÑ‰∫∫„Å†„Åë</div>
                        <div class="section-subtitle">ÂÜÖÈù¢„Å´Ëß¶„Çå„ÇãË≥™Âïè„Åü„Å°</div>
                    </div>
                    <span class="section-arrow">‚ñº</span>
                </div>
                <div class="section-content">
                    <div class="section-inner" id="deepQuestions"></div>
                </div>
            </div>
        </div>

        <!-- „Éû„Ç§„Éö„Éº„Ç∏ -->
        <div id="profilePage" class="page">
            <div class="profile-card">
                <h3>üë§ „Éó„É≠„Éï„Ç£„Éº„É´</h3>
                <div style="margin-bottom: 15px;">
                    <div style="font-size: 14px; color: #666; margin-bottom: 5px;">„Éã„ÉÉ„ÇØ„Éç„Éº„É†</div>
                    <div style="font-size: 16px; font-weight: 600;" id="profileNickname"></div>
                </div>
            </div>

            <div class="profile-card">
                <h3>ü§ù ÂèãÈÅî„Ç≥„Éº„Éâ</h3>
                <div class="friend-code-display">
                    <div class="friend-code-label">„ÅÇ„Å™„Åü„ÅÆÂèãÈÅî„Ç≥„Éº„Éâ</div>
                    <div class="friend-code-value" id="myFriendCode">------</div>
                </div>
                <p style="font-size: 13px; color: #666; line-height: 1.6;">
                    „Åì„ÅÆ„Ç≥„Éº„Éâ„ÇíÂèãÈÅî„Å´Êïô„Åà„Å¶„ÄÅ<br>
                    ÂèãÈÅî„Çæ„Éº„É≥„ÅßÊó•Ë®ò„ÇíÂÖ±Êúâ„Åó„Çà„ÅÜ
                </p>
                
                <div class="friend-code-input-area">
                    <label>ÂèãÈÅî„ÅÆ„Ç≥„Éº„Éâ„ÇíÂÖ•Âäõ</label>
                    <div class="friend-input-group">
                        <input type="text" id="friendCodeInput" placeholder="6Ê°Å„ÅÆ„Ç≥„Éº„Éâ" maxlength="6" pattern="[0-9]{6}">
                        <button onclick="addFriend()">ËøΩÂä†</button>
                    </div>
                </div>
            </div>

            <!-- ‰ªäÊó•Âèó„ÅëÂèñ„Å£„ÅüÂèçÂøú -->
            <div class="profile-card">
                <h3>üíù ‰ªäÊó•Âèó„ÅëÂèñ„Å£„ÅüÂèçÂøú</h3>
                <div id="todayReactionsList"></div>
            </div>

            <!-- Êõ¥Êñ∞Â±•Ê≠¥ -->
            <div class="changelog-card">
                <h3>üìã Êõ¥Êñ∞Â±•Ê≠¥</h3>
                <div id="changelogList"></div>
            </div>
        </div>

        <!-- Ëá™ÂàÜ„ÅÆÊó•Ë®ò„Éö„Éº„Ç∏ -->
        <div id="myPage" class="page">
            <div id="myDiariesContent"></div>
        </div>

        <!-- „Åø„Çì„Å™„ÅÆÊó•Ë®ò„Éö„Éº„Ç∏ -->
        <div id="feedPage" class="page">
            <!-- „Çæ„Éº„É≥ÈÅ∏Êäû -->
            <div class="feed-zone-selector">
                <button class="zone-btn active" onclick="switchZone('friends')">üë• ÂèãÈÅî„Çæ„Éº„É≥</button>
                <button class="zone-btn" onclick="switchZone('global')">üåç ÂÖ®‰∏ñÁïå„Çæ„Éº„É≥</button>
            </div>
            <div id="feedContent"></div>
        </div>
    </div>

    <!-- ‰øùÂ≠ò„Éú„Çø„É≥ -->
    <div class="save-btn-container">
        <button class="btn btn-primary" id="saveBtn" onclick="saveDiary()">üìù ‰øùÂ≠ò„Åô„Çã</button>
    </div>

    <script>
        // „Éê„Éº„Ç∏„Éß„É≥ÊÉÖÂ†±
        const APP_VERSION = 'v0.0.8';
        
        // Êõ¥Êñ∞Â±•Ê≠¥ÔºàÊñ∞„Åó„ÅÑÈ†ÜÔºâ
        const CHANGELOG = [
            {
                version: 'v0.0.8',
                date: '2026/01/09',
                description: '„É™„Ç¢„ÇØ„Ç∑„Éß„É≥Ê©üËÉΩ„ÅÆ‰∏çÂÖ∑Âêà‰øÆÊ≠£ÔºàDB‰øùÂ≠ò„ÉªUIÂèçÊò†„Éª„Éá„Éê„ÉÉ„Ç∞„É≠„Ç∞ËøΩÂä†Ôºâ'
            },
            {
                version: 'v0.0.7',
                date: '2026/01/09',
                description: 'ÂèãÈÅî„Ç≥„Éº„Éâ„ÇíËá™ÂãïÁîüÊàê„Åó„Å¶Ë°®Á§∫'
            },
            {
                version: 'v0.0.6',
                date: '2026/01/08',
                description: '„É≠„Ç∞„Ç§„É≥Ê©üËÉΩ„ÅÆ‰∏çÂÖ∑Âêà‰øÆÊ≠£„Å®„Éá„Éê„ÉÉ„Ç∞Ê©üËÉΩËøΩÂä†'
            },
            {
                version: 'v0.0.5',
                date: '2026/01/08',
                description: '„É™„Ç¢„ÇØ„Ç∑„Éß„É≥Ê©üËÉΩ„ÅÆÂÆåÂÖ®ÂÆüË£ÖÔºàDB‰øùÂ≠òÂØæÂøúÔºâ'
            },
            {
                version: 'v0.0.4',
                date: '2026/01/08',
                description: 'ÂèãÈÅî„Ç≥„Éº„ÉâÊ©üËÉΩ„Å®„Çæ„Éº„É≥ÂàáÊõø„ÇíËøΩÂä†'
            },
            {
                version: 'v0.0.3',
                date: '2026/01/07',
                description: 'SafariÊõ¥Êñ∞ÊôÇ„ÅÆ„É≠„Ç∞„Ç§„É≥Âæ©Â∏∞Ê©üËÉΩ„ÇíËøΩÂä†'
            },
            {
                version: 'v0.0.2',
                date: '2026/01/06',
                description: '„Éã„ÉÉ„ÇØ„Éç„Éº„É†+PINË™çË®º„Å®„Éû„Ç§„Éö„Éº„Ç∏„ÇíËøΩÂä†'
            },
            {
                version: 'v0.0.1',
                date: '2026/01/05',
                description: 'ÂàùÂõû„É™„É™„Éº„Çπ - Âü∫Êú¨ÁöÑ„Å™Êó•Ë®òÊ©üËÉΩ'
            }
        ];

        // ÁÆ°ÁêÜËÄÖ„Ç≥„Éº„Éâ
        const ADMIN_CODE = "1234";

        // „Éá„Éº„ÇøÂÆöÁæ©
        const quickQuestions = [
            "‰ªäÊó•„ÅÆ happy",
            "‰ªäÊó•„ÅÆËá™ÂàÜ„ÇíË§í„ÇÅ„Åü„ÅÑ„Å®„Åì„Çç",
            "‰ªäÊó•„ÅÆ„ÇÑ„Å£„Å°„Åæ„Å£„Åü„Ç®„Éî„ÇΩ„Éº„Éâ",
            "‰ªäÊó•‰ΩïÈ£ü„Åπ„Åü?",
            "‰ªäÊó•„ÄÅ„ÅÇ„Çä„Åå„Å®„ÅÜ„Çí‰ºù„Åà„Åü„ÅÑ„Åì„Å®",
            "‰ªäÊó•„ÅÆÊúçË£Ö„Çí‰∏ÄË®Ä„ÅßË®Ä„ÅÜ„Å®?",
            "‰ªäÊó•„ÅÆ‰ΩìË™ø„Éª„Ç≥„É≥„Éá„Ç£„Ç∑„Éß„É≥",
            "„Åø„Çì„Å™„Å´„Ç∑„Çß„Ç¢„Åó„Åü„ÅÑ„Åì„Å®",
            "ÊòéÊó•Ê•Ω„Åó„Åø„Å´„Åó„Å¶„Çã„Åì„Å®",
            "ÊòéÊó•„ÇÑ„Çä„Åü„ÅÑ‰∫ã"
        ];

        const deepQuestions = [
            "‰ªäÊó•„ÄÅ„ÅÑ„Å°„Å∞„ÇìÊ∞óÊåÅ„Å°„ÅåÊè∫„Çå„Åü„Åì„Å®„ÅØ?",
            "‰ªäÊó•„ÄÅÂÆâÂøÉ„Åó„ÅüÁû¨Èñì„ÅØ?",
            "‰ªäÊó•„ÄÅ„Å°„Çá„Å£„Å®ÁÑ°ÁêÜ„Åó„Å¶„Åü„Åã„ÇÇ„Å®ÊÄù„ÅÜÁû¨Èñì„ÅÇ„Å£„Åü?",
            "‰ªäÊó•„ÄÅÊ≠£Áõ¥„ÇÅ„Çì„Å©„Åè„Åï„Åã„Å£„Åü„Åì„Å®",
            "‰ªäÊó•„ÄÅ„ÇÑ„Çâ„Å™„Åè„Å¶„Çà„Åã„Å£„Åü„Å®ÊÄù„ÅÜ„Åì„Å®",
            "‰ªäÊó•„ÄÅ„Å™„Çì„Å®„Å™„ÅèÂºï„Å£„Åã„Åã„Å£„Å¶„Çã„Åì„Å®",
            "„Åù„ÅÆÂºï„Å£„Åã„Åã„Çä„ÅØ„ÄÅ‰Ωï„ÅåÂ§ß‰∫ã„Å†„Åã„Çâ„Å†„Å®ÊÄù„ÅÜ?",
            "„ÇÇ„ÅóÂèã„Å†„Å°„ÅåÂêå„Åò1Êó•„ÇíÈÅé„Åî„Åó„Å¶„Åü„Çâ„ÄÅ„Å™„Çì„Å¶Â£∞„Åã„Åë„Çã?",
            "ÊòéÊó•„Å©„ÅÜ„Å™„Å£„Åü„Çâ„Åæ„ÅÇok?",
            "‰ªäÊó•„ÅÆËá™ÂàÜ„Å´„Å®„Å£„Å¶„ÄÅ„ÅÑ„Å°„Å∞„ÇìÂÆà„Çä„Åü„Åã„Å£„Åü„ÇÇ„ÅÆ„ÅØ?"
        ];

        const randomQuestionPool = [
            "‰ªäÊó•„Çí‰∏ÄË®Ä„Åß„Çø„Ç§„Éà„É´„Å´„Åô„Çã„Å®?",
            "‰ªäÊó•„ÅÆBGM„ÅØ?",
            "‰ªäÊó•„ÇíËâ≤„ÅßË°®„Åô„Å®?",
            "‰ªäÊó•„ÅÑ„Å°„Å∞„Çì‰∫∫Èñì„Å£„ÅΩ„Åã„Å£„ÅüÁû¨Èñì„ÅØ?",
            "‰ªäÊó•„ÅÆ„Äå„Åæ„ÅÇ„ÅÑ„Å£„Åã„Äç„ÅØ„Å©„Çå?",
            "‰ªäÊó•„ÅÆLOVE„ÅØ?",
            "‰ªäÊó•„ÅÑ„Å°„Å∞„ÇìÁ¨ë„Å£„Åü„Åì„Å®",
            "‰ªäÊó•„ÅÆÂ∞è„Åï„Å™Áô∫Ë¶ã",
            "‰ªäÊó•„ÅÆËá™ÂàÜ„ÇíÂãïÁâ©„Å´‰æã„Åà„Çã„Å®?"
        ];

        // Áä∂ÊÖãÁÆ°ÁêÜ
        let currentPage = 'write';
        let currentNickname = '';
        let currentPin = '';
        let currentUserId = '';
        let currentGroupId = '';
        let myFriendCode = '';
        let favorites = [];
        let diaries = [];
        let reactions = []; // „ÄêÈáçË¶Å„ÄëÂÖ±ÊúâDB„Å®„Åó„Å¶Êâ±„ÅÜ
        let todayDiary = null;
        let isEditMode = false;
        let titleTapCount = 0;
        let titleTapTimer = null;
        let lastPage = 'write';
        let currentZone = 'friends';

        // ÂàùÊúüÂåñ
        window.onload = function() {
            console.log('[ÂàùÊúüÂåñ] „Ç¢„Éó„É™Ëµ∑Âãï', APP_VERSION);
            initFriendCode();
            checkLogin();
        };

        // ÂèãÈÅî„Ç≥„Éº„Éâ„ÇíÂàùÊúüÂåñÔºàËá™ÂãïÁîüÊàêÔºâ
        function initFriendCode() {
            console.log('[ÂèãÈÅî„Ç≥„Éº„Éâ] ÂàùÊúüÂåñÈñãÂßã');
            
            let savedCode = localStorage.getItem('myFriendCode');
            
            if (!savedCode) {
                savedCode = String(Math.floor(Math.random() * 1000000)).padStart(6, '0');
                localStorage.setItem('myFriendCode', savedCode);
                console.log('[ÂèãÈÅî„Ç≥„Éº„Éâ] Êñ∞Ë¶èÁîüÊàê:', savedCode);
            } else {
                console.log('[ÂèãÈÅî„Ç≥„Éº„Éâ] Êó¢Â≠ò„Ç≥„Éº„ÉâË™≠„ÅøËæº„Åø:', savedCode);
            }
            
            myFriendCode = savedCode;
        }

        // „Ç∞„É≠„Éº„Éê„É´„Ç®„É©„ÉºË°®Á§∫
        function showGlobalError(message) {
            const errorDiv = document.getElementById('globalError');
            errorDiv.textContent = message;
            errorDiv.classList.add('show');
            console.error('[„Ç∞„É≠„Éº„Éê„É´„Ç®„É©„Éº]', message);
            
            setTimeout(() => {
                errorDiv.classList.remove('show');
            }, 5000);
        }

        // JST(Êó•Êú¨ÊôÇÈñì)„Åß‰ªäÊó•„ÅÆÊó•‰ªò„ÇíÂèñÂæó (YYYY-MM-DD)
        function getTodayJST() {
            const now = new Date();
            const jstOffset = 9 * 60;
            const utc = now.getTime() + (now.getTimezoneOffset() * 60000);
            const jstTime = new Date(utc + (jstOffset * 60000));
            
            const year = jstTime.getFullYear();
            const month = String(jstTime.getMonth() + 1).padStart(2, '0');
            const day = String(jstTime.getDate()).padStart(2, '0');
            
            return `${year}-${month}-${day}`;
        }

        // „É¶„Éº„Ç∂„ÉºID„ÇíÁîüÊàêÔºà„Éã„ÉÉ„ÇØ„Éç„Éº„É†+PIN„ÅÆÂõ∫ÂÆö„Éè„ÉÉ„Ç∑„É•Ôºâ
        function generateUserId(nickname, pin) {
            try {
                return btoa(nickname + ':' + pin).replace(/[^a-zA-Z0-9]/g, '');
            } catch (e) {
                console.error('[„Ç®„É©„Éº] „É¶„Éº„Ç∂„ÉºIDÁîüÊàêÂ§±Êïó:', e);
                return 'user_' + Date.now();
            }
        }

        // „Ç®„É©„Éº„É°„ÉÉ„Çª„Éº„Ç∏Ë°®Á§∫
        function showError(message) {
            const errorDiv = document.getElementById('loginError');
            errorDiv.textContent = message;
            errorDiv.classList.add('show');
            console.error('[„Ç®„É©„ÉºË°®Á§∫]', message);
        }

        // „Ç®„É©„Éº„É°„ÉÉ„Çª„Éº„Ç∏„ÇíÈö†„Åô
        function hideError() {
            const errorDiv = document.getElementById('loginError');
            errorDiv.classList.remove('show');
        }

        // „É≠„Ç∞„Ç§„É≥„Çø„ÉñÂàá„ÇäÊõø„Åà
        function switchLoginTab(tab) {
            console.log('[„Çø„ÉñÂàáÊõø]', tab);
            hideError();
            
            document.querySelectorAll('.login-tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.login-form').forEach(f => f.classList.remove('active'));
            
            if (tab === 'login') {
                document.querySelectorAll('.login-tab')[0].classList.add('active');
                document.getElementById('loginForm').classList.add('active');
            } else {
                document.querySelectorAll('.login-tab')[1].classList.add('active');
                document.getElementById('registerForm').classList.add('active');
            }
        }

        // ÈÄöÂ∏∏„É≠„Ç∞„Ç§„É≥„Å´Âàá„ÇäÊõø„Åà
        function switchToFullLogin() {
            console.log('[„Éï„É´„É≠„Ç∞„Ç§„É≥„Å´ÂàáÊõø]');
            hideError();
            document.getElementById('quickLoginForm').classList.remove('active');
            document.getElementById('loginTabs').style.display = 'flex';
            document.getElementById('loginForm').classList.add('active');
            document.getElementById('loginMessage').textContent = '„Éã„ÉÉ„ÇØ„Éç„Éº„É†„Å®PIN„Åß\n„É≠„Ç∞„Ç§„É≥„Åæ„Åü„ÅØÊñ∞Ë¶èÁôªÈå≤„Åó„Å¶„Åè„Å†„Åï„ÅÑ';
        }

        // „É≠„Ç∞„Ç§„É≥Ê©üËÉΩ„ÉÅ„Çß„ÉÉ„ÇØ
        function checkLogin() {
            console.log('[„É≠„Ç∞„Ç§„É≥Á¢∫Ë™ç] ÈñãÂßã');
            try {
                const savedAuth = localStorage.getItem('userAuth');
                const savedPage = localStorage.getItem('lastPage');
                
                if (savedAuth) {
                    console.log('[„É≠„Ç∞„Ç§„É≥Á¢∫Ë™ç] ‰øùÂ≠òÊ∏à„ÅøË™çË®ºÊÉÖÂ†±„ÅÇ„Çä');
                    const auth = JSON.parse(savedAuth);
                    
                    document.getElementById('loginMessage').textContent = 'PIN„ÇíÂÖ•Âäõ„Åó„Å¶„É≠„Ç∞„Ç§„É≥';
                    document.getElementById('loginTabs').style.display = 'none';
                    document.getElementById('returningNickname').textContent = auth.nickname;
                    document.getElementById('quickLoginForm').classList.add('active');
                    document.getElementById('loginOverlay').classList.remove('hidden');
                    
                    setTimeout(() => {
                        document.getElementById('quickLoginPin').focus();
                    }, 100);
                    
                    if (savedPage) {
                        lastPage = savedPage;
                        console.log('[„É≠„Ç∞„Ç§„É≥Á¢∫Ë™ç] ÂâçÂõû„ÅÆ„Éö„Éº„Ç∏:', savedPage);
                    }
                } else {
                    console.log('[„É≠„Ç∞„Ç§„É≥Á¢∫Ë™ç] Êñ∞Ë¶è„É¶„Éº„Ç∂„Éº');
                    document.getElementById('loginOverlay').classList.remove('hidden');
                }
                console.log('[„É≠„Ç∞„Ç§„É≥Á¢∫Ë™ç] ÂÆå‰∫Ü');
            } catch (e) {
                console.error('[„É≠„Ç∞„Ç§„É≥Á¢∫Ë™ç] „Ç®„É©„Éº:', e);
                showError('„É≠„Ç∞„Ç§„É≥Á¢∫Ë™ç‰∏≠„Å´„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü: ' + e.message);
            }
        }

        // Á∞°Êòì„É≠„Ç∞„Ç§„É≥Ôºà„É™„Éî„Éº„Çø„ÉºÁî®Ôºâ
        function quickLogin() {
            console.log('[Á∞°Êòì„É≠„Ç∞„Ç§„É≥] ÈñãÂßã');
            hideError();
            
            try {
                const pin = document.getElementById('quickLoginPin').value.trim();
                const savedAuth = JSON.parse(localStorage.getItem('userAuth'));
                
                console.log('[Á∞°Êòì„É≠„Ç∞„Ç§„É≥] PINÂÖ•Âäõ:', pin ? '****' : '(Á©∫)');

                if (!pin) {
                    showError('PIN„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                    return;
                }

                if (!/^\d{4}$/.test(pin)) {
                    showError('PIN„ÅØÂçäËßíÊï∞Â≠ó4Ê°Å„ÅßÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                    return;
                }

                const users = JSON.parse(localStorage.getItem('users') || '{}');
                console.log('[Á∞°Êòì„É≠„Ç∞„Ç§„É≥] „É¶„Éº„Ç∂„ÉºÊ§úË®º‰∏≠...');
                
                if (!users[savedAuth.nickname]) {
                    showError('„É¶„Éº„Ç∂„ÉºÊÉÖÂ†±„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì');
                    return;
                }
                
                if (users[savedAuth.nickname].pin !== pin) {
                    showError('PIN„ÅåÊ≠£„Åó„Åè„ÅÇ„Çä„Åæ„Åõ„Çì');
                    document.getElementById('quickLoginPin').value = '';
                    return;
                }

                console.log('[Á∞°Êòì„É≠„Ç∞„Ç§„É≥] Ë™çË®ºÊàêÂäü');
                
                currentNickname = savedAuth.nickname;
                currentPin = pin;
                currentUserId = generateUserId(currentNickname, currentPin);
                currentGroupId = users[currentNickname].groupId || '';
                
                console.log('[Á∞°Êòì„É≠„Ç∞„Ç§„É≥] „É¶„Éº„Ç∂„ÉºÊÉÖÂ†±Ë®≠ÂÆöÂÆå‰∫Ü');

                document.getElementById('loginOverlay').classList.add('hidden');
                console.log('[Á∞°Êòì„É≠„Ç∞„Ç§„É≥] „É≠„Ç∞„Ç§„É≥ÁîªÈù¢ÈùûË°®Á§∫');
                
                setTimeout(() => {
                    console.log('[Á∞°Êòì„É≠„Ç∞„Ç§„É≥] „Ç¢„Éó„É™ÂàùÊúüÂåñÈñãÂßã');
                    initApp();
                    restoreLastPage();
                    console.log('[Á∞°Êòì„É≠„Ç∞„Ç§„É≥] ÂÆå‰∫Ü');
                }, 50);
                
            } catch (e) {
                console.error('[Á∞°Êòì„É≠„Ç∞„Ç§„É≥] ‰æãÂ§ñÁô∫Áîü:', e);
                showError('„É≠„Ç∞„Ç§„É≥Âá¶ÁêÜ‰∏≠„Å´„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü: ' + e.message);
            }
        }

        // Êñ∞Ë¶èÁôªÈå≤
        function register() {
            console.log('[Êñ∞Ë¶èÁôªÈå≤] ÈñãÂßã');
            hideError();
            
            try {
                const nickname = document.getElementById('registerNickname').value.trim();
                const pin = document.getElementById('registerPin').value.trim();
                const pinConfirm = document.getElementById('registerPinConfirm').value.trim();

                console.log('[Êñ∞Ë¶èÁôªÈå≤] „Éã„ÉÉ„ÇØ„Éç„Éº„É†:', nickname || '(Á©∫)');

                if (!nickname) {
                    showError('„Éã„ÉÉ„ÇØ„Éç„Éº„É†„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                    return;
                }

                if (nickname.length < 2) {
                    showError('„Éã„ÉÉ„ÇØ„Éç„Éº„É†„ÅØ2ÊñáÂ≠ó‰ª•‰∏ä„ÅßÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                    return;
                }

                if (!pin) {
                    showError('PIN„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                    return;
                }

                if (!/^\d{4}$/.test(pin)) {
                    showError('PIN„ÅØÂçäËßíÊï∞Â≠ó4Ê°Å„ÅßÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                    return;
                }

                if (pin !== pinConfirm) {
                    showError('PIN„Åå‰∏ÄËá¥„Åó„Åæ„Åõ„Çì');
                    return;
                }

                const users = JSON.parse(localStorage.getItem('users') || '{}');
                
                if (users[nickname]) {
                    showError('„Åì„ÅÆ„Éã„ÉÉ„ÇØ„Éç„Éº„É†„ÅØÊó¢„Å´‰ΩøÁî®„Åï„Çå„Å¶„ÅÑ„Åæ„Åô');
                    return;
                }

                console.log('[Êñ∞Ë¶èÁôªÈå≤] „Éê„É™„Éá„Éº„Ç∑„Éß„É≥ÈÄöÈÅé');

                users[nickname] = { 
                    pin: pin, 
                    groupId: myFriendCode
                };
                localStorage.setItem('users', JSON.stringify(users));

                currentNickname = nickname;
                currentPin = pin;
                currentUserId = generateUserId(currentNickname, currentPin);
                currentGroupId = myFriendCode;
                localStorage.setItem('userAuth', JSON.stringify({ nickname, pin }));

                console.log('[Êñ∞Ë¶èÁôªÈå≤] „É¶„Éº„Ç∂„ÉºÊÉÖÂ†±‰øùÂ≠òÂÆå‰∫Ü');

                document.getElementById('loginOverlay').classList.add('hidden');
                
                setTimeout(() => {
                    console.log('[Êñ∞Ë¶èÁôªÈå≤] „Ç¢„Éó„É™ÂàùÊúüÂåñÈñãÂßã');
                    initApp();
                    console.log('[Êñ∞Ë¶èÁôªÈå≤] ÂÆå‰∫Ü');
                }, 50);
                
            } catch (e) {
                console.error('[Êñ∞Ë¶èÁôªÈå≤] ‰æãÂ§ñÁô∫Áîü:', e);
                showError('ÁôªÈå≤Âá¶ÁêÜ‰∏≠„Å´„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü: ' + e.message);
            }
        }

        // „É≠„Ç∞„Ç§„É≥
        function login() {
            console.log('[„É≠„Ç∞„Ç§„É≥] ÈñãÂßã');
            hideError();
            
            try {
                const nickname = document.getElementById('loginNickname').value.trim();
                const pin = document.getElementById('loginPin').value.trim();

                console.log('[„É≠„Ç∞„Ç§„É≥] „Éã„ÉÉ„ÇØ„Éç„Éº„É†:', nickname || '(Á©∫)');

                if (!nickname) {
                    showError('„Éã„ÉÉ„ÇØ„Éç„Éº„É†„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                    return;
                }

                if (!pin) {
                    showError('PIN„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                    return;
                }

                if (!/^\d{4}$/.test(pin)) {
                    showError('PIN„ÅØÂçäËßíÊï∞Â≠ó4Ê°Å„ÅßÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                    return;
                }

                const users = JSON.parse(localStorage.getItem('users') || '{}');
                console.log('[„É≠„Ç∞„Ç§„É≥] „É¶„Éº„Ç∂„ÉºÊ§úË®º‰∏≠...');
                
                if (!users[nickname]) {
                    showError('„Åì„ÅÆ„Éã„ÉÉ„ÇØ„Éç„Éº„É†„ÅØÁôªÈå≤„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì');
                    return;
                }

                if (users[nickname].pin !== pin) {
                    showError('PIN„ÅåÊ≠£„Åó„Åè„ÅÇ„Çä„Åæ„Åõ„Çì');
                    return;
                }

                console.log('[„É≠„Ç∞„Ç§„É≥] Ë™çË®ºÊàêÂäü');

                currentNickname = nickname;
                currentPin = pin;
                currentUserId = generateUserId(currentNickname, currentPin);
                currentGroupId = users[nickname].groupId || '';
                localStorage.setItem('userAuth', JSON.stringify({ nickname, pin }));

                console.log('[„É≠„Ç∞„Ç§„É≥] „É¶„Éº„Ç∂„ÉºÊÉÖÂ†±Ë®≠ÂÆöÂÆå‰∫Ü');

                document.getElementById('loginOverlay').classList.add('hidden');
                
                setTimeout(() => {
                    console.log('[„É≠„Ç∞„Ç§„É≥] „Ç¢„Éó„É™ÂàùÊúüÂåñÈñãÂßã');
                    initApp();
                    console.log('[„É≠„Ç∞„Ç§„É≥] ÂÆå‰∫Ü');
                }, 50);
                
            } catch (e) {
                console.error('[„É≠„Ç∞„Ç§„É≥] ‰æãÂ§ñÁô∫Áîü:', e);
                showError('„É≠„Ç∞„Ç§„É≥Âá¶ÁêÜ‰∏≠„Å´„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü: ' + e.message);
            }
        }

        // „É≠„Ç∞„Ç¢„Ç¶„Éà
        function logout() {
            if (confirm('„É≠„Ç∞„Ç¢„Ç¶„Éà„Åó„Åæ„Åô„Åã?')) {
                localStorage.setItem('lastPage', currentPage);
                localStorage.removeItem('userAuth');
                location.reload();
            }
        }

        // ÂâçÂõû„ÅÆ„Éö„Éº„Ç∏„ÇíÂæ©ÂÖÉ
        function restoreLastPage() {
            if (lastPage && lastPage !== 'write') {
                setTimeout(() => {
                    switchPage(lastPage);
                }, 100);
            }
        }

        // „Çø„Ç§„Éà„É´„Çø„ÉÉ„Éó„Ç§„Éô„É≥„ÉàÔºà7Âõû„ÅßÁÆ°ÁêÜËÄÖ„Éë„Éç„É´Ôºâ
        function handleTitleTap() {
            titleTapCount++;
            
            if (titleTapTimer) {
                clearTimeout(titleTapTimer);
            }

            if (titleTapCount >= 7) {
                titleTapCount = 0;
                openAdminPanel();
                return;
            }

            titleTapTimer = setTimeout(() => {
                titleTapCount = 0;
            }, 2000);
        }

        // ÁÆ°ÁêÜËÄÖ„Éë„Éç„É´„ÇíÈñã„Åè
        function openAdminPanel() {
            const code = prompt('ÁÆ°ÁêÜËÄÖ„Ç≥„Éº„Éâ„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ:');
            if (code === ADMIN_CODE) {
                document.getElementById('adminOverlay').classList.add('show');
                renderAdminDiaries();
            } else if (code !== null) {
                alert('ÁÆ°ÁêÜËÄÖ„Ç≥„Éº„Éâ„ÅåÊ≠£„Åó„Åè„ÅÇ„Çä„Åæ„Åõ„Çì');
            }
        }

        // ÁÆ°ÁêÜËÄÖ„Éë„Éç„É´„ÇíÈñâ„Åò„Çã
        function closeAdminPanel() {
            document.getElementById('adminOverlay').classList.remove('show');
        }

        // ÁÆ°ÁêÜËÄÖ„Éë„Éç„É´„ÅÆÊó•Ë®ò‰∏ÄË¶ß
        function renderAdminDiaries() {
            const content = document.getElementById('adminDiariesContent');
            
            if (diaries.length === 0) {
                content.innerHTML = '<div class="empty-state"><div class="empty-state-text">ÊäïÁ®ø„Åå„ÅÇ„Çä„Åæ„Åõ„Çì</div></div>';
                return;
            }

            const sortedDiaries = [...diaries].sort((a, b) => new Date(b.date) - new Date(a.date));
            
            content.innerHTML = sortedDiaries.map(diary => {
                let contentHtml = '';
                
                contentHtml += `<div class="admin-diary-field"><span class="admin-diary-label">Ê∞óÂàÜ:</span>${escapeHtml(diary.mood)}</div>`;
                contentHtml += `<div class="admin-diary-field"><span class="admin-diary-label">ÊÆã„Åó„Åü„ÅÑ„Åì„Å®:</span>${escapeHtml(diary.memorable)}</div>`;
                contentHtml += `<div class="admin-diary-field"><span class="admin-diary-label">Ëá™ÂàÜ„Å´‰∏ÄË®Ä:</span>${escapeHtml(diary.selfTalk)}</div>`;
                
                if (diary.randomAnswer) {
                    contentHtml += `<div class="admin-diary-field"><span class="admin-diary-label">${escapeHtml(diary.randomQuestion)}:</span>${escapeHtml(diary.randomAnswer)}</div>`;
                }

                if (diary.optionalAnswers && diary.optionalAnswers.length > 0) {
                    diary.optionalAnswers.forEach(item => {
                        contentHtml += `<div class="admin-diary-field"><span class="admin-diary-label">${escapeHtml(item.question)}:</span>${escapeHtml(item.answer)}</div>`;
                    });
                }

                return `
                    <div class="admin-diary-item" data-nickname="${escapeHtml(diary.nickname)}" data-date="${diary.postDate}">
                        <div class="admin-diary-header">
                            <div>
                                <div class="admin-diary-info"><strong>„Éã„ÉÉ„ÇØ„Éç„Éº„É†:</strong> ${escapeHtml(diary.nickname)}</div>
                                <div class="admin-diary-info"><strong>ÊäïÁ®øÊó•:</strong> ${diary.postDate} ${formatFullDate(diary.date)}</div>
                                <div class="admin-diary-info"><strong>„Ç∞„É´„Éº„ÉóID:</strong> ${diary.groupId || 'Êú™Ë®≠ÂÆö'}</div>
                            </div>
                            <div class="admin-diary-info">ID: ${diary.id}</div>
                        </div>
                        <div class="admin-diary-content">
                            ${contentHtml}
                        </div>
                    </div>
                `;
            }).join('');
        }

        // ÁÆ°ÁêÜËÄÖ„Éë„Éç„É´„ÅÆÊ§úÁ¥¢„Éï„Ç£„É´„Çø„Éº
        function filterAdminDiaries() {
            const nicknameFilter = document.getElementById('adminSearchNickname').value.toLowerCase();
            const dateFilter = document.getElementById('adminSearchDate').value;

            document.querySelectorAll('.admin-diary-item').forEach(item => {
                const nickname = item.dataset.nickname.toLowerCase();
                const date = item.dataset.date;

                const nicknameMatch = !nicknameFilter || nickname.includes(nicknameFilter);
                const dateMatch = !dateFilter || date === dateFilter;

                item.style.display = (nicknameMatch && dateMatch) ? 'block' : 'none';
            });
        }

        // CSVÂá∫Âäõ
        function exportCSV() {
            if (diaries.length === 0) {
                alert('„Ç®„ÇØ„Çπ„Éù„Éº„Éà„Åô„ÇãÊäïÁ®ø„Åå„ÅÇ„Çä„Åæ„Åõ„Çì');
                return;
            }

            let csv = 'ID,„Éã„ÉÉ„ÇØ„Éç„Éº„É†,ÊäïÁ®øÊó•,Êó•ÊôÇ,„Ç∞„É´„Éº„ÉóID,Ê∞óÂàÜ,ÊÆã„Åó„Åü„ÅÑ„Åì„Å®,Ëá™ÂàÜ„Å´‰∏ÄË®Ä,„É©„É≥„ÉÄ„É†Ë≥™Âïè,„É©„É≥„ÉÄ„É†ÂõûÁ≠î\n';

            diaries.forEach(diary => {
                const row = [
                    diary.id,
                    diary.nickname,
                    diary.postDate,
                    diary.date,
                    diary.groupId || '',
                    diary.mood,
                    diary.memorable.replace(/"/g, '""'),
                    diary.selfTalk.replace(/"/g, '""'),
                    diary.randomQuestion ? diary.randomQuestion.replace(/"/g, '""') : '',
                    diary.randomAnswer ? diary.randomAnswer.replace(/"/g, '""') : ''
                ];

                csv += row.map(field => `"${field}"`).join(',') + '\n';
            });

            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `diaries_${getTodayJST()}.csv`;
            link.click();
        }

        // „Ç¢„Éó„É™ÂàùÊúüÂåñÔºàÈÅÖÂª∂Ë™≠„ÅøËæº„ÅøÂØæÂøúÔºâ
        function initApp() {
            console.log('[„Ç¢„Éó„É™ÂàùÊúüÂåñ] ÈñãÂßã');
            try {
                document.getElementById('userInfo').textContent = `üë§ ${currentNickname}`;
                
                loadUserData();
                
                renderQuestions();
                setRandomQuestion();
                updateFavoriteSection();
                checkTodayDiary();
                updateFeedButton();
                loadTodayDiaryToForm();
                renderProfilePage();
                renderChangelog();
                
                console.log('[„Ç¢„Éó„É™ÂàùÊúüÂåñ] ÂÆå‰∫Ü');
            } catch (e) {
                console.error('[„Ç¢„Éó„É™ÂàùÊúüÂåñ] „Ç®„É©„Éº:', e);
                showGlobalError('„Ç¢„Éó„É™„ÅÆÂàùÊúüÂåñ‰∏≠„Å´„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü: ' + e.message);
            }
        }

        // „É¶„Éº„Ç∂„Éº„Åî„Å®„ÅÆ„Éá„Éº„ÇøË™≠„ÅøËæº„Åø
        function loadUserData() {
            console.log('[„Éá„Éº„ÇøË™≠„ÅøËæº„Åø] ÈñãÂßã');
            try {
                favorites = JSON.parse(localStorage.getItem(`favorites_${currentNickname}`) || '[]');
                diaries = JSON.parse(localStorage.getItem('diaries') || '[]');
                reactions = JSON.parse(localStorage.getItem('reactions') || '[]'); // „ÄêÈáçË¶Å„ÄëÂÖ±ÊúâDB
                console.log('[„Éá„Éº„ÇøË™≠„ÅøËæº„Åø] ÂÆå‰∫Ü - „ÅäÊ∞ó„Å´ÂÖ•„Çä:', favorites.length, 'Êó•Ë®ò:', diaries.length, 'ÂèçÂøú:', reactions.length);
            } catch (e) {
                console.error('[„Éá„Éº„ÇøË™≠„ÅøËæº„Åø] „Ç®„É©„Éº:', e);
                favorites = [];
                diaries = [];
                reactions = [];
            }
        }

        // „É¶„Éº„Ç∂„Éº„Åî„Å®„ÅÆ„Éá„Éº„Çø‰øùÂ≠ò
        function saveUserData() {
            localStorage.setItem(`favorites_${currentNickname}`, JSON.stringify(favorites));
            localStorage.setItem('diaries', JSON.stringify(diaries));
            localStorage.setItem('reactions', JSON.stringify(reactions)); // „ÄêÈáçË¶Å„ÄëÂÖ±ÊúâDB‰øùÂ≠ò
        }

        // „Éó„É≠„Éï„Ç£„Éº„É´„Éö„Éº„Ç∏„ÅÆË°®Á§∫
        function renderProfilePage() {
            document.getElementById('profileNickname').textContent = currentNickname;
            document.getElementById('myFriendCode').textContent = myFriendCode;
            console.log('[„Éó„É≠„Éï„Ç£„Éº„É´] ÂèãÈÅî„Ç≥„Éº„ÉâË°®Á§∫:', myFriendCode);
            
            renderTodayReactions();
        }

        // Êõ¥Êñ∞Â±•Ê≠¥„ÅÆË°®Á§∫
        function renderChangelog() {
            const list = document.getElementById('changelogList');
            
            list.innerHTML = CHANGELOG.map(item => `
                <div class="changelog-item">
                    <div class="changelog-version">
                        ${item.version}
                        <span class="changelog-date">${item.date}</span>
                    </div>
                    <div class="changelog-description">${item.description}</div>
                </div>
            `).join('');
        }

        // ÂèãÈÅî„ÇíËøΩÂä†
        function addFriend() {
            const friendCode = document.getElementById('friendCodeInput').value.trim();
            
            if (!friendCode) {
                alert('ÂèãÈÅî„Ç≥„Éº„Éâ„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                return;
            }

            if (!/^\d{6}$/.test(friendCode)) {
                alert('6Ê°Å„ÅÆÊï∞Â≠ó„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                return;
            }

            if (friendCode === myFriendCode) {
                alert('Ëá™ÂàÜ„ÅÆ„Ç≥„Éº„Éâ„ÅØËøΩÂä†„Åß„Åç„Åæ„Åõ„Çì');
                return;
            }

            const users = JSON.parse(localStorage.getItem('users') || '{}');
            if (users[currentNickname]) {
                users[currentNickname].groupId = friendCode;
                currentGroupId = friendCode;
                localStorage.setItem('users', JSON.stringify(users));
                
                alert('ÂèãÈÅî„Ç≥„Éº„Éâ„ÇíËøΩÂä†„Åó„Åæ„Åó„Åü!\nÂèãÈÅî„Çæ„Éº„É≥„ÅßÁõ∏Êâã„ÅÆÊó•Ë®ò„ÅåË¶ã„Çâ„Çå„Åæ„Åô');
                document.getElementById('friendCodeInput').value = '';
                renderProfilePage();
            }
        }

        // „ÄêÊîπ‰øÆ„Äë‰ªäÊó•Âèó„ÅëÂèñ„Å£„ÅüÂèçÂøú„ÇíË°®Á§∫ÔºàentryId„ÅÆÊäïÁ®øÊÉÖÂ†±„ÇÇË°®Á§∫Ôºâ
        function renderTodayReactions() {
            const list = document.getElementById('todayReactionsList');
            const todayDate = getTodayJST();
            
            console.log('[ÂèçÂøúË°®Á§∫] toUserId:', currentUserId, '‰ªäÊó•„ÅÆÊó•‰ªò:', todayDate);
            
            // Ëá™ÂàÜÂÆõ„Å¶„ÅÆ‰ªäÊó•„ÅÆÂèçÂøú„ÇíÂèñÂæó
            const todayReactions = reactions.filter(r => 
                r.toUserId === currentUserId && 
                r.createdAt.startsWith(todayDate)
            );

            console.log('[ÂèçÂøúË°®Á§∫] ‰ªäÊó•„ÅÆÂèçÂøúÊï∞:', todayReactions.length);

            if (todayReactions.length === 0) {
                list.innerHTML = '<div style="text-align: center; color: #999; padding: 20px;">„Åæ„Å†ÂèçÂøú„Åå„ÅÇ„Çä„Åæ„Åõ„Çì</div>';
                return;
            }

            list.innerHTML = todayReactions.map(r => {
                // entryId„Åã„ÇâÊäïÁ®ø„ÇíÁâπÂÆö
                const entry = diaries.find(d => d.id === r.entryId);
                const entryInfo = entry ? `${entry.postDate} „ÅÆÊäïÁ®ø` : `ÊäïÁ®øID: ${r.entryId}`;
                
                return `
                    <div class="reaction-item">
                        <span class="reaction-type">${r.type}</span>
                        <span class="reaction-time">${formatTime(r.createdAt)}</span>
                        <div class="reaction-entry-info">${entryInfo}</div>
                    </div>
                `;
            }).join('');
        }

        function formatTime(dateString) {
            const date = new Date(dateString);
            const hours = String(date.getHours()).padStart(2, '0');
            const minutes = String(date.getMinutes()).padStart(2, '0');
            return `${hours}:${minutes}`;
        }

        // ‰ªäÊó•„ÅÆÊó•Ë®ò„Åå„ÅÇ„Çå„Å∞„Éï„Ç©„Éº„É†„Å´Âæ©ÂÖÉ
        function loadTodayDiaryToForm() {
            if (!todayDiary) {
                isEditMode = false;
                document.getElementById('saveBtn').textContent = 'üìù ‰øùÂ≠ò„Åô„Çã';
                return;
            }

            isEditMode = true;
            document.getElementById('saveBtn').textContent = 'üîÑ Êõ¥Êñ∞„Åô„Çã';

            document.getElementById('mood').value = todayDiary.mood || '';
            document.getElementById('memorable').value = todayDiary.memorable || '';
            document.getElementById('selfTalk').value = todayDiary.selfTalk || '';
            
            document.querySelectorAll('.mood-tag').forEach(tag => {
                tag.classList.remove('selected');
                if (tag.textContent === todayDiary.mood) {
                    tag.classList.add('selected');
                }
            });

            if (todayDiary.randomAnswer) {
                document.getElementById('randomAnswer').value = todayDiary.randomAnswer;
                document.getElementById('randomPublic').checked = todayDiary.randomPublic || false;
                document.getElementById('randomAnonymous').checked = todayDiary.randomAnonymous || false;
            }

            if (todayDiary.optionalAnswers && todayDiary.optionalAnswers.length > 0) {
                todayDiary.optionalAnswers.forEach(item => {
                    const textarea = document.getElementById(item.id);
                    const publicCheckbox = document.getElementById(`${item.id}_public`);
                    const anonymousCheckbox = document.getElementById(`${item.id}_anonymous`);
                    
                    if (textarea) {
                        textarea.value = item.answer;
                        if (publicCheckbox) publicCheckbox.checked = item.isPublic || false;
                        if (anonymousCheckbox) anonymousCheckbox.checked = item.isAnonymous || false;
                        
                        const questionToggle = textarea.closest('.question-item').querySelector('.question-toggle');
                        const inputArea = textarea.closest('.question-input-area');
                        if (questionToggle && inputArea) {
                            questionToggle.classList.add('expanded');
                            inputArea.classList.add('expanded');
                        }
                    }
                });
            }
        }

        // Ë≥™Âïè„ÅÆ„É¨„É≥„ÉÄ„É™„É≥„Ç∞ÔºàÂÖ¨ÈñãË®≠ÂÆö‰ªò„ÅçÔºâ
        function renderQuestions() {
            renderQuestionList('quickQuestions', quickQuestions, 'quick');
            renderQuestionList('deepQuestions', deepQuestions, 'deep');
        }

        function renderQuestionList(containerId, questions, category) {
            const container = document.getElementById(containerId);
            container.innerHTML = questions.map((q, index) => {
                const isFavorite = favorites.some(f => f.question === q && f.category === category);
                const questionId = `${category}_${index}`;
                return `
                    <div class="question-item">
                        <div class="question-toggle" onclick="toggleQuestionItem(this)">
                            <button class="favorite-btn" onclick="event.stopPropagation(); toggleFavorite('${escapeHtml(q)}', '${category}', this)">
                                ${isFavorite ? '‚≠ê' : '‚òÜ'}
                            </button>
                            <span class="question-text">${escapeHtml(q)}</span>
                            <span class="question-arrow">‚ñº</span>
                        </div>
                        <div class="question-input-area">
                            <textarea id="${questionId}" data-question="${escapeHtml(q)}" placeholder="Ëá™Áî±„Å´Êõ∏„ÅÑ„Å¶„Åø„Å¶„Åè„Å†„Åï„ÅÑ"></textarea>
                            <div class="privacy-controls">
                                <div class="privacy-checkbox">
                                    <input type="checkbox" id="${questionId}_public">
                                    <label for="${questionId}_public">ÂÖ¨Èñã„Åô„Çã</label>
                                </div>
                                <div class="privacy-checkbox">
                                    <input type="checkbox" id="${questionId}_anonymous">
                                    <label for="${questionId}_anonymous">ÂåøÂêç„ÅßÂÖ¨Èñã</label>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // „É©„É≥„ÉÄ„É†Ë≥™Âïè„ÅÆË®≠ÂÆö
        function setRandomQuestion() {
            const today = new Date().toDateString();
            let savedQuestion = localStorage.getItem('todayRandomQuestion');
            let savedDate = localStorage.getItem('todayRandomQuestionDate');

            if (savedDate !== today) {
                const randomIndex = Math.floor(Math.random() * randomQuestionPool.length);
                savedQuestion = randomQuestionPool[randomIndex];
                localStorage.setItem('todayRandomQuestion', savedQuestion);
                localStorage.setItem('todayRandomQuestionDate', today);
            }

            document.getElementById('randomQuestionText').textContent = savedQuestion;
        }

        // „ÅäÊ∞ó„Å´ÂÖ•„ÇäÊ©üËÉΩ
        function toggleFavorite(question, category, buttonElement) {
            const existingIndex = favorites.findIndex(f => f.question === question && f.category === category);
            
            if (existingIndex >= 0) {
                favorites.splice(existingIndex, 1);
            } else {
                if (favorites.length >= 5) {
                    alert('„ÅäÊ∞ó„Å´ÂÖ•„Çä„ÅØÊúÄÂ§ß5ÂÄã„Åæ„Åß„Åß„Åô');
                    return;
                }
                favorites.push({ question, category });
            }
            
            saveUserData();
            renderQuestions();
            updateFavoriteSection();
        }

        function updateFavoriteSection() {
            const section = document.getElementById('favoriteSection');
            const list = document.getElementById('favoriteQuestionsList');
            
            if (favorites.length === 0) {
                section.style.display = 'none';
                return;
            }
            
            section.style.display = 'block';
            list.innerHTML = favorites.map((fav, index) => {
                const questionId = `fav_${index}`;
                return `
                    <div class="question-item">
                        <div class="question-toggle" onclick="toggleQuestionItem(this)">
                            <span class="question-text">${escapeHtml(fav.question)}</span>
                            <span class="question-arrow">‚ñº</span>
                        </div>
                        <div class="question-input-area">
                            <textarea id="${questionId}" data-question="${escapeHtml(fav.question)}" placeholder="Ëá™Áî±„Å´Êõ∏„ÅÑ„Å¶„Åø„Å¶„Åè„Å†„Åï„ÅÑ"></textarea>
                            <div class="privacy-controls">
                                <div class="privacy-checkbox">
                                    <input type="checkbox" id="${questionId}_public">
                                    <label for="${questionId}_public">ÂÖ¨Èñã„Åô„Çã</label>
                                </div>
                                <div class="privacy-checkbox">
                                    <input type="checkbox" id="${questionId}_anonymous">
                                    <label for="${questionId}_anonymous">ÂåøÂêç„ÅßÂÖ¨Èñã</label>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // „Çª„ÇØ„Ç∑„Éß„É≥ÈñãÈñâ
        function toggleSection(header) {
            header.classList.toggle('expanded');
            const content = header.nextElementSibling;
            content.classList.toggle('expanded');
        }

        // ÂÄãÂà•Ë≥™Âïè„ÅÆÈñãÈñâ
        function toggleQuestionItem(toggleElement) {
            toggleElement.classList.toggle('expanded');
            const inputArea = toggleElement.nextElementSibling;
            inputArea.classList.toggle('expanded');
        }

        // Ê∞óÂàÜÈÅ∏Êäû
        function selectMood(element, mood) {
            document.querySelectorAll('.mood-tag').forEach(tag => {
                tag.classList.remove('selected');
            });
            element.classList.add('selected');
            document.getElementById('mood').value = mood;
        }

        // ‰ªªÊÑèË≥™Âïè„ÅÆÂõûÁ≠î„ÇíÂèéÈõÜÔºàÂÖ¨ÈñãË®≠ÂÆöÂê´„ÇÄÔºâ
        function collectOptionalAnswers() {
            const answers = [];
            const allTextareas = document.querySelectorAll('textarea[data-question]');
            
            allTextareas.forEach(textarea => {
                const answer = textarea.value.trim();
                if (answer) {
                    const id = textarea.id;
                    const publicCheckbox = document.getElementById(`${id}_public`);
                    const anonymousCheckbox = document.getElementById(`${id}_anonymous`);
                    
                    answers.push({
                        id: id,
                        question: textarea.getAttribute('data-question'),
                        answer: answer,
                        isPublic: publicCheckbox ? publicCheckbox.checked : false,
                        isAnonymous: anonymousCheckbox ? anonymousCheckbox.checked : false
                    });
                }
            });
            
            return answers;
        }

        // Êó•Ë®ò‰øùÂ≠ò
        function saveDiary() {
            const mood = document.getElementById('mood').value;
            const memorable = document.getElementById('memorable').value;
            const selfTalk = document.getElementById('selfTalk').value;

            if (!mood || !memorable || !selfTalk) {
                alert('ÂøÖÈ†àÈ†ÖÁõÆ(Ê∞óÂàÜ„ÉªÊÆã„Åó„Åü„ÅÑ„Åì„Å®„ÉªËá™ÂàÜ„Å´‰∏ÄË®Ä)„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                return;
            }

            const optionalAnswers = collectOptionalAnswers();
            const todayDate = getTodayJST();

            // „ÄêÈáçË¶Å„ÄëentryId„ÅØÂõ∫ÂÆöÔºàÁ∑®ÈõÜÊôÇ„ÅØ„Åù„ÅÆ„Åæ„Åæ„ÄÅÊñ∞Ë¶èÊôÇ„ÅØDate.now()Ôºâ
            const diary = {
                id: isEditMode ? todayDiary.id : Date.now(),
                date: new Date().toISOString(),
                postDate: todayDate,
                nickname: currentNickname,
                userId: currentUserId,
                groupId: currentGroupId,
                mood,
                memorable,
                selfTalk,
                randomQuestion: document.getElementById('randomQuestionText').textContent,
                randomAnswer: document.getElementById('randomAnswer').value,
                randomPublic: document.getElementById('randomPublic').checked,
                randomAnonymous: document.getElementById('randomAnonymous').checked,
                optionalAnswers: optionalAnswers
            };

            console.log('[Êó•Ë®ò‰øùÂ≠ò] entryId:', diary.id, 'userId:', diary.userId);

            if (isEditMode) {
                const index = diaries.findIndex(d => d.id === todayDiary.id);
                if (index >= 0) {
                    diaries[index] = diary;
                }
            } else {
                diaries.unshift(diary);
            }

            todayDiary = diary;
            saveUserData();

            const successMsg = document.getElementById('successMessage');
            const successText = document.getElementById('successMessageText');
            successText.textContent = isEditMode ? 'Êó•Ë®ò„ÇíÊõ¥Êñ∞„Åó„Åæ„Åó„Åü!' : 'Êó•Ë®ò„Çí‰øùÂ≠ò„Åó„Åæ„Åó„Åü!';
            successMsg.classList.add('show');
            setTimeout(() => {
                successMsg.classList.remove('show');
            }, 3000);

            isEditMode = true;
            document.getElementById('saveBtn').textContent = 'üîÑ Êõ¥Êñ∞„Åô„Çã';

            updateFeedButton();

            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // ‰ªäÊó•„ÅÆÊó•Ë®ò„ÉÅ„Çß„ÉÉ„ÇØ
        function checkTodayDiary() {
            const todayDate = getTodayJST();
            todayDiary = diaries.find(d => 
                d.postDate === todayDate && 
                d.nickname === currentNickname
            );
        }

        // „Éï„Ç£„Éº„Éâ„Éú„Çø„É≥„ÅÆÊõ¥Êñ∞
        function updateFeedButton() {
            const feedBtn = document.getElementById('feedNavBtn');
            if (todayDiary) {
                feedBtn.textContent = '„Åø„Çì„Å™„ÅÆÊó•Ë®ò';
                feedBtn.disabled = false;
                feedBtn.style.opacity = '1';
            } else {
                feedBtn.textContent = '„Åø„Çì„Å™„ÅÆÊó•Ë®ò üîí';
                feedBtn.disabled = false;
                feedBtn.style.opacity = '0.5';
            }
        }

        // „Éö„Éº„Ç∏Âàá„ÇäÊõø„Åà
        function switchPage(page) {
            if (page === 'feed' && !todayDiary) {
                alert('‰ªäÊó•„ÅÆÊó•Ë®ò„ÇíÊõ∏„Åè„Å®„ÄÅ„Åø„Çì„Å™„ÅÆÊó•Ë®ò„ÅåË¶ã„Çâ„Çå„Çã„Çà„ÅÜ„Å´„Å™„Çä„Åæ„Åô');
                return;
            }

            currentPage = page;
            localStorage.setItem('lastPage', page);
            
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
            
            if (page === 'write') {
                document.getElementById('writePage').classList.add('active');
                document.querySelector('.nav-btn:nth-child(1)').classList.add('active');
                document.querySelector('.save-btn-container').style.display = 'block';
            } else if (page === 'profile') {
                document.getElementById('profilePage').classList.add('active');
                document.querySelector('.nav-btn:nth-child(2)').classList.add('active');
                document.querySelector('.save-btn-container').style.display = 'none';
                renderProfilePage();
            } else if (page === 'my') {
                document.getElementById('myPage').classList.add('active');
                document.querySelector('.nav-btn:nth-child(3)').classList.add('active');
                document.querySelector('.save-btn-container').style.display = 'none';
                renderMyDiaries();
            } else if (page === 'feed') {
                document.getElementById('feedPage').classList.add('active');
                document.querySelector('.nav-btn:nth-child(4)').classList.add('active');
                document.querySelector('.save-btn-container').style.display = 'none';
                renderFeed();
            }
        }

        // „Çæ„Éº„É≥Âàá„ÇäÊõø„Åà
        function switchZone(zone) {
            currentZone = zone;
            document.querySelectorAll('.zone-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            renderFeed();
        }

        // Ëá™ÂàÜ„ÅÆÊó•Ë®ò‰∏ÄË¶ß„ÇíË°®Á§∫
        function renderMyDiaries() {
            const myDiariesContent = document.getElementById('myDiariesContent');
            const myDiaries = diaries.filter(d => d.nickname === currentNickname);

            if (myDiaries.length === 0) {
                myDiariesContent.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üìù</div>
                        <div class="empty-state-text">
                            „Åæ„Å†Êó•Ë®ò„ÇíÊõ∏„ÅÑ„Å¶„ÅÑ„Åæ„Åõ„Çì<br>
                            „ÄåÊõ∏„Åè„Äç„Çø„Éñ„Åã„ÇâÂßã„ÇÅ„Åæ„Åó„Çá„ÅÜ
                        </div>
                    </div>
                `;
                return;
            }

            myDiariesContent.innerHTML = myDiaries.map(diary => {
                let contentHtml = '';

                contentHtml += `
                    <div class="my-diary-question">
                        <div class="my-diary-question-title">ÊÆã„Åó„Åü„ÅÑ„Åì„Å®</div>
                        <div class="my-diary-question-answer">${escapeHtml(diary.memorable)}</div>
                    </div>
                `;

                contentHtml += `
                    <div class="my-diary-question">
                        <div class="my-diary-question-title">Ëá™ÂàÜ„Å´‰∏ÄË®Ä</div>
                        <div class="my-diary-question-answer">${escapeHtml(diary.selfTalk)}</div>
                    </div>
                `;

                if (diary.randomAnswer) {
                    contentHtml += `
                        <div class="my-diary-question">
                            <div class="my-diary-question-title">${escapeHtml(diary.randomQuestion)}</div>
                            <div class="my-diary-question-answer">${escapeHtml(diary.randomAnswer)}</div>
                        </div>
                    `;
                }

                if (diary.optionalAnswers && diary.optionalAnswers.length > 0) {
                    diary.optionalAnswers.forEach(item => {
                        contentHtml += `
                            <div class="my-diary-question">
                                <div class="my-diary-question-title">${escapeHtml(item.question)}</div>
                                <div class="my-diary-question-answer">${escapeHtml(item.answer)}</div>
                            </div>
                        `;
                    });
                }

                return `
                    <div class="my-diary-item">
                        <div class="my-diary-header">
                            <span class="my-diary-date">${formatFullDate(diary.date)}</span>
                            <span class="my-diary-mood">${escapeHtml(diary.mood)}</span>
                        </div>
                        <div class="my-diary-content">
                            ${contentHtml}
                        </div>
                        <button class="delete-diary-btn" onclick="deleteDiary(${diary.id})">üóëÔ∏è ÂâäÈô§</button>
                    </div>
                `;
            }).join('');
        }

        // Êó•Ë®òÂâäÈô§
        function deleteDiary(diaryId) {
            if (!confirm('„Åì„ÅÆÊó•Ë®ò„ÇíÂâäÈô§„Åó„Åæ„Åô„Åã?')) {
                return;
            }

            const index = diaries.findIndex(d => d.id === diaryId);
            if (index >= 0) {
                diaries.splice(index, 1);
                saveUserData();
                
                if (todayDiary && todayDiary.id === diaryId) {
                    todayDiary = null;
                    isEditMode = false;
                    document.getElementById('saveBtn').textContent = 'üìù ‰øùÂ≠ò„Åô„Çã';
                    updateFeedButton();
                }
                
                renderMyDiaries();
            }
        }

        // ÂÆåÂÖ®„Å™Êó•‰ªò„Éï„Ç©„Éº„Éû„ÉÉ„Éà
        function formatFullDate(dateString) {
            const date = new Date(dateString);
            const year = date.getFullYear();
            const month = date.getMonth() + 1;
            const day = date.getDate();
            const weekdays = ['Êó•', 'Êúà', 'ÁÅ´', 'Ê∞¥', 'Êú®', 'Èáë', 'Âúü'];
            const weekday = weekdays[date.getDay()];
            
            return `${year}Âπ¥${month}Êúà${day}Êó•(${weekday})`;
        }

        // XSSÂØæÁ≠ñ„ÅÆHTML„Ç®„Çπ„Ç±„Éº„Éó
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // „ÄêÊîπ‰øÆ„ÄëentryId„Åî„Å®„ÅÆ„É™„Ç¢„ÇØ„Ç∑„Éß„É≥Êï∞„ÇíÂèñÂæó
        function getReactionCountByEntry(entryId) {
            return reactions.filter(r => r.entryId === entryId).length;
        }

        // „Éï„Ç£„Éº„ÉâË°®Á§∫ÔºàÂèãÈÅî„Çæ„Éº„É≥/ÂÖ®‰∏ñÁïå„Çæ„Éº„É≥ÂØæÂøúÔºâ
        function renderFeed() {
            const feedContent = document.getElementById('feedContent');
            
            if (!todayDiary) {
                feedContent.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üîí</div>
                        <div class="empty-state-text">
                            ‰ªäÊó•„ÅÆÊó•Ë®ò„ÇíÊõ∏„Åè„Å®<br>
                            „Åø„Çì„Å™„ÅÆÊó•Ë®ò„ÅåË¶ã„Çâ„Çå„Åæ„Åô
                        </div>
                    </div>
                `;
                return;
            }

            const todayDate = getTodayJST();
            
            let filteredDiaries = diaries.filter(d => 
                d.postDate === todayDate && 
                d.id !== todayDiary.id
            );

            if (currentZone === 'friends') {
                filteredDiaries = filteredDiaries.filter(d => d.groupId === currentGroupId);
            }
            
            if (filteredDiaries.length === 0) {
                const message = currentZone === 'friends' 
                    ? '„Åæ„Å†ÂèãÈÅî„ÅÆÊó•Ë®ò„Åå„ÅÇ„Çä„Åæ„Åõ„Çì<br>ÂèãÈÅî„Ç≥„Éº„Éâ„Çí‰∫§Êèõ„Åó„Å¶„Åø„Åæ„Åó„Çá„ÅÜ'
                    : '„Åæ„Å†Ë™∞„ÇÇ‰ªäÊó•„ÅÆÊó•Ë®ò„ÇíÊõ∏„ÅÑ„Å¶„ÅÑ„Åæ„Åõ„Çì<br>„ÅÇ„Å™„Åü„ÅåÊúÄÂàù„ÅÆ‰∏Ä‰∫∫„Åß„Åô';
                    
                feedContent.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üìù</div>
                        <div class="empty-state-text">${message}</div>
                    </div>
                `;
                return;
            }

            feedContent.innerHTML = filteredDiaries.map(diary => {
                let contentHtml = '';

                contentHtml += `
                    <div class="feed-question">
                        <div class="feed-question-title">Ê∞óÂàÜ</div>
                        <div class="feed-question-answer">${escapeHtml(diary.mood)}</div>
                    </div>
                `;

                contentHtml += `
                    <div class="feed-question">
                        <div class="feed-question-title">ÊÆã„Åó„Åü„ÅÑ„Åì„Å®</div>
                        <div class="feed-question-answer">${escapeHtml(diary.memorable)}</div>
                    </div>
                `;

                contentHtml += `
                    <div class="feed-question">
                        <div class="feed-question-title">Ëá™ÂàÜ„Å´‰∏ÄË®Ä</div>
                        <div class="feed-question-answer">${escapeHtml(diary.selfTalk)}</div>
                    </div>
                `;

                if (diary.randomAnswer && diary.randomPublic) {
                    contentHtml += `
                        <div class="feed-question">
                            <div class="feed-question-title">${escapeHtml(diary.randomQuestion)}</div>
                            <div class="feed-question-answer">${escapeHtml(diary.randomAnswer)}</div>
                        </div>
                    `;
                }

                if (diary.optionalAnswers && diary.optionalAnswers.length > 0) {
                    diary.optionalAnswers.forEach(item => {
                        if (item.isPublic) {
                            contentHtml += `
                                <div class="feed-question">
                                    <div class="feed-question-title">${escapeHtml(item.question)}</div>
                                    <div class="feed-question-answer">${escapeHtml(item.answer)}</div>
                                </div>
                            `;
                        }
                    });
                }

                let authorName = diary.nickname;
                
                const hasAnonymousAnswer = 
                    (diary.randomAnswer && diary.randomPublic && diary.randomAnonymous) ||
                    (diary.optionalAnswers && diary.optionalAnswers.some(a => a.isPublic && a.isAnonymous));
                
                if (hasAnonymousAnswer) {
                    authorName = 'ÂåøÂêç';
                }

                // „ÄêÊîπ‰øÆ„Äë„Åì„ÅÆentry„Å´ÂØæ„Åô„ÇãËá™ÂàÜ„ÅÆ„É™„Ç¢„ÇØ„Ç∑„Éß„É≥„ÇíÂèñÂæó
                const sentReaction = reactions.find(r => 
                    r.fromUserId === currentUserId && 
                    r.entryId === diary.id
                );

                // „ÄêÊîπ‰øÆ„Äë„Åì„ÅÆentry„ÅÆÁ∑è„É™„Ç¢„ÇØ„Ç∑„Éß„É≥Êï∞„ÇíÂèñÂæó
                const reactionCount = getReactionCountByEntry(diary.id);

                return `
                    <div class="feed-item">
                        <div class="feed-header">
                            <span class="feed-author">${escapeHtml(authorName)}</span>
                            <span class="feed-date">${formatDate(diary.date)}</span>
                        </div>
                        <div class="feed-content">
                            ${contentHtml}
                        </div>
                        <div class="feed-reactions">
                            <button class="reaction-btn ${sentReaction && sentReaction.type === '„Çè„Åã„Çã' ? 'sent' : ''}" onclick="sendReaction(${diary.id}, '${diary.userId}', '„Çè„Åã„Çã')">
                                üí≠ „Çè„Åã„Çã${sentReaction && sentReaction.type === '„Çè„Åã„Çã' ? '<span class="reaction-count">ÈÄÅ‰ø°Ê∏à</span>' : ''}
                            </button>
                            <button class="reaction-btn ${sentReaction && sentReaction.type === 'Á¨ë„Å£„Åü' ? 'sent' : ''}" onclick="sendReaction(${diary.id}, '${diary.userId}', 'Á¨ë„Å£„Åü')">
                                üòä Á¨ë„Å£„Åü${sentReaction && sentReaction.type === 'Á¨ë„Å£„Åü' ? '<span class="reaction-count">ÈÄÅ‰ø°Ê∏à</span>' : ''}
                            </button>
                            <button class="reaction-btn ${sentReaction && sentReaction.type === '„Åù„Å£„Å®ÂÖ±ÊÑü' ? 'sent' : ''}" onclick="sendReaction(${diary.id}, '${diary.userId}', '„Åù„Å£„Å®ÂÖ±ÊÑü')">
                                ü§ù „Åù„Å£„Å®ÂÖ±ÊÑü${sentReaction && sentReaction.type === '„Åù„Å£„Å®ÂÖ±ÊÑü' ? '<span class="reaction-count">ÈÄÅ‰ø°Ê∏à</span>' : ''}
                            </button>
                            <button class="reaction-btn ${sentReaction && sentReaction.type === 'Â§ß‰∏àÂ§´„Åù„ÅÜ' ? 'sent' : ''}" onclick="sendReaction(${diary.id}, '${diary.userId}', 'Â§ß‰∏àÂ§´„Åù„ÅÜ')">
                                üëç Â§ß‰∏àÂ§´„Åù„ÅÜ${sentReaction && sentReaction.type === 'Â§ß‰∏àÂ§´„Åù„ÅÜ' ? '<span class="reaction-count">ÈÄÅ‰ø°Ê∏à</span>' : ''}
                            </button>
                            <button class="reaction-btn ${sentReaction && sentReaction.type === '„Åù„ÇåÂ•Ω„Åç' ? 'sent' : ''}" onclick="sendReaction(${diary.id}, '${diary.userId}', '„Åù„ÇåÂ•Ω„Åç')">
                                ‚ù§Ô∏è „Åù„ÇåÂ•Ω„Åç${sentReaction && sentReaction.type === '„Åù„ÇåÂ•Ω„Åç' ? '<span class="reaction-count">ÈÄÅ‰ø°Ê∏à</span>' : ''}
                            </button>
                        </div>
                        ${reactionCount > 0 ? `<div style="text-align: right; font-size: 12px; color: #aaa; margin-top: 8px;">ÂèçÂøú: ${reactionCount}‰ª∂</div>` : ''}
                    </div>
                `;
            }).join('');
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            const now = new Date();
            const diff = now - date;
            const hours = Math.floor(diff / (1000 * 60 * 60));
            
            if (hours < 1) {
                return '„Åü„Å£„Åü‰ªä';
            } else if (hours < 24) {
                return `${hours}ÊôÇÈñìÂâç`;
            } else {
                return `${Math.floor(hours / 24)}Êó•Ââç`;
            }
        }

        // „ÄêÊîπ‰øÆ„Äë„É™„Ç¢„ÇØ„Ç∑„Éß„É≥ÈÄÅ‰ø°ÔºàDB‰øùÂ≠ò„Éª„Éê„É™„Éá„Éº„Ç∑„Éß„É≥„ÉªUIÂèçÊò†Ôºâ
        function sendReaction(entryId, toUserId, reactionType) {
            console.log('[„É™„Ç¢„ÇØ„Ç∑„Éß„É≥ÈÄÅ‰ø°] ÈñãÂßã');
            console.log('[„É™„Ç¢„ÇØ„Ç∑„Éß„É≥ÈÄÅ‰ø°] entryId:', entryId);
            console.log('[„É™„Ç¢„ÇØ„Ç∑„Éß„É≥ÈÄÅ‰ø°] toUserId:', toUserId);
            console.log('[„É™„Ç¢„ÇØ„Ç∑„Éß„É≥ÈÄÅ‰ø°] fromUserId:', currentUserId);
            console.log('[„É™„Ç¢„ÇØ„Ç∑„Éß„É≥ÈÄÅ‰ø°] type:', reactionType);
            
            try {
                // „Éê„É™„Éá„Éº„Ç∑„Éß„É≥
                if (!entryId) {
                    throw new Error('entryId„Åå‰∏çÊ≠£„Åß„Åô');
                }
                
                if (!toUserId) {
                    throw new Error('toUserId„Åå‰∏çÊ≠£„Åß„Åô');
                }
                
                if (!currentUserId) {
                    throw new Error('„É≠„Ç∞„Ç§„É≥„Åó„Å¶„ÅÑ„Åæ„Åõ„Çì');
                }

                // Êó¢Â≠ò„ÅÆ„É™„Ç¢„ÇØ„Ç∑„Éß„É≥„ÇíÊ§úÁ¥¢
                const existingReactionIndex = reactions.findIndex(r => 
                    r.fromUserId === currentUserId && 
                    r.entryId === entryId
                );

                if (existingReactionIndex >= 0) {
                    // Âêå„Åò„É™„Ç¢„ÇØ„Ç∑„Éß„É≥„Å™„ÇâÂèñ„ÇäÊ∂à„Åó
                    if (reactions[existingReactionIndex].type === reactionType) {
                        console.log('[„É™„Ç¢„ÇØ„Ç∑„Éß„É≥ÈÄÅ‰ø°] Âèñ„ÇäÊ∂à„Åó');
                        reactions.splice(existingReactionIndex, 1);
                        
                        // DB‰øùÂ≠ò
                        saveUserData();
                        console.log('[„É™„Ç¢„ÇØ„Ç∑„Éß„É≥ÈÄÅ‰ø°] DB‰øùÂ≠òÊàêÂäü');
                        
                        // UIÂÜçÊèèÁîª
                        renderFeed();
                        renderProfilePage();
                        
                        alert('„É™„Ç¢„ÇØ„Ç∑„Éß„É≥„ÇíÂèñ„ÇäÊ∂à„Åó„Åæ„Åó„Åü');
                        console.log('[„É™„Ç¢„ÇØ„Ç∑„Éß„É≥ÈÄÅ‰ø°] ÂÆå‰∫Ü (Âèñ„ÇäÊ∂à„Åó)');
                        return;
                    } else {
                        // ÈÅï„ÅÜ„É™„Ç¢„ÇØ„Ç∑„Éß„É≥„Å™„ÇâÊõ¥Êñ∞
                        console.log('[„É™„Ç¢„ÇØ„Ç∑„Éß„É≥ÈÄÅ‰ø°] Êõ¥Êñ∞');
                        reactions[existingReactionIndex].type = reactionType;
                        reactions[existingReactionIndex].createdAt = new Date().toISOString();
                    }
                } else {
                    // Êñ∞Ë¶è„É™„Ç¢„ÇØ„Ç∑„Éß„É≥„ÇíËøΩÂä†
                    console.log('[„É™„Ç¢„ÇØ„Ç∑„Éß„É≥ÈÄÅ‰ø°] Êñ∞Ë¶èËøΩÂä†');
                    const newReaction = {
                        id: Date.now(),
                        entryId: entryId,
                        fromUserId: currentUserId,
                        toUserId: toUserId,
                        type: reactionType,
                        createdAt: new Date().toISOString()
                    };
                    reactions.push(newReaction);
                    console.log('[„É™„Ç¢„ÇØ„Ç∑„Éß„É≥ÈÄÅ‰ø°] Êñ∞Ë¶èÂèçÂøú:', newReaction);
                }

                // „ÄêÈáçË¶Å„ÄëDB‰øùÂ≠ò
                saveUserData();
                console.log('[„É™„Ç¢„ÇØ„Ç∑„Éß„É≥ÈÄÅ‰ø°] DB‰øùÂ≠òÊàêÂäü');
                console.log('[„É™„Ç¢„ÇØ„Ç∑„Éß„É≥ÈÄÅ‰ø°] ÁèæÂú®„ÅÆÂèçÂøúÁ∑èÊï∞:', reactions.length);
                
                // „ÄêÈáçË¶Å„ÄëUIÂèçÊò†ÔºàÂÜçÊèèÁîªÔºâ
                renderFeed();
                renderProfilePage();
                
                alert(`„Äå${reactionType}„Äç„ÇíÈÄÅ„Çä„Åæ„Åó„Åü`);
                console.log('[„É™„Ç¢„ÇØ„Ç∑„Éß„É≥ÈÄÅ‰ø°] ÂÆå‰∫Ü');
                
            } catch (error) {
                console.error('[„É™„Ç¢„ÇØ„Ç∑„Éß„É≥ÈÄÅ‰ø°] „Ç®„É©„Éº:', error);
                showGlobalError('„É™„Ç¢„ÇØ„Ç∑„Éß„É≥ÈÄÅ‰ø°‰∏≠„Å´„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü: ' + error.message);
            }
        }
    </script>
</body>
</html>
