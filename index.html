<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ä»Šæ—¥ã®æ—¥è¨˜ v0.0.22</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    body {
      font-family: 'Helvetica Neue', Arial, 'Hiragino Kaku Gothic ProN', 'Hiragino Sans', Meiryo, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 0;
      color: #333;
    }
    .container {
      max-width: 600px;
      margin: 0 auto;
      background: white;
      min-height: 100vh;
      box-shadow: 0 0 20px rgba(0,0,0,0.1);
      display: flex;
      flex-direction: column;
    }
    .header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 1rem;
      text-align: center;
      position: sticky;
      top: 0;
      z-index: 100;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    .header h1 {
      font-size: 1.5rem;
      margin-bottom: 0.5rem;
    }
    .version {
      font-size: 0.75rem;
      opacity: 0.9;
      cursor: pointer;
    }
    .tabs {
      display: flex;
      background: #f8f9fa;
      border-bottom: 1px solid #dee2e6;
      position: sticky;
      top: 70px;
      z-index: 99;
    }
    .tab {
      flex: 1;
      padding: 0.875rem 0.5rem;
      text-align: center;
      background: #f8f9fa;
      border: none;
      cursor: pointer;
      font-size: 0.9rem;
      color: #6c757d;
      transition: all 0.2s;
      border-bottom: 3px solid transparent;
    }
    .tab.active {
      color: #667eea;
      background: white;
      border-bottom: 3px solid #667eea;
      font-weight: 600;
    }
    .content {
      flex: 1;
      overflow-y: auto;
    }
    .tab-content {
      display: none;
      padding: 1rem;
      animation: fadeIn 0.3s;
    }
    .tab-content.active {
      display: block;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .form-group {
      margin-bottom: 1rem;
    }
    .form-group label {
      display: block;
      margin-bottom: 0.5rem;
      color: #495057;
      font-weight: 500;
      font-size: 0.95rem;
    }
    .form-group input,
    .form-group textarea,
    .form-group select {
      width: 100%;
      padding: 0.75rem;
      border: 2px solid #e9ecef;
      border-radius: 8px;
      font-size: 1rem;
      transition: border-color 0.2s;
      font-family: inherit;
    }
    .form-group input:focus,
    .form-group textarea:focus,
    .form-group select:focus {
      outline: none;
      border-color: #667eea;
    }
    .form-group textarea {
      min-height: 100px;
      resize: vertical;
    }
    .mood-chips {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      margin-top: 0.5rem;
    }
    .mood-chip {
      padding: 0.5rem 1rem;
      border: 2px solid #e9ecef;
      border-radius: 20px;
      background: white;
      cursor: pointer;
      transition: all 0.2s;
      font-size: 0.9rem;
      color: #495057;
    }
    .mood-chip:hover {
      border-color: #667eea;
      background: #f8f9ff;
    }
    .mood-chip.selected {
      background: #667eea;
      color: white;
      border-color: #667eea;
    }
    .btn-primary {
      width: 100%;
      padding: 1rem;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s;
      margin-top: 1rem;
    }
    .btn-primary:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
    }
    .btn-primary:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }
    .btn-secondary {
      padding: 0.5rem 1rem;
      background: #6c757d;
      color: white;
      border: none;
      border-radius: 6px;
      font-size: 0.9rem;
      cursor: pointer;
      transition: background 0.2s;
    }
    .btn-secondary:hover {
      background: #5a6268;
    }
    .btn-danger {
      padding: 0.5rem 1rem;
      background: #dc3545;
      color: white;
      border: none;
      border-radius: 6px;
      font-size: 0.9rem;
      cursor: pointer;
      transition: background 0.2s;
    }
    .btn-danger:hover {
      background: #c82333;
    }
    .diary-card {
      background: white;
      border-radius: 12px;
      padding: 1rem;
      margin-bottom: 1rem;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
      transition: box-shadow 0.2s;
    }
    .diary-card:hover {
      box-shadow: 0 4px 16px rgba(0,0,0,0.12);
    }
    .diary-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 0.75rem;
      padding-bottom: 0.75rem;
      border-bottom: 1px solid #f0f0f0;
    }
    .diary-meta {
      display: flex;
      flex-direction: column;
      gap: 0.25rem;
    }
    .diary-nickname {
      font-weight: 600;
      color: #667eea;
      font-size: 1rem;
    }
    .diary-date {
      font-size: 0.85rem;
      color: #6c757d;
    }
    .diary-zone {
      font-size: 0.8rem;
      padding: 0.25rem 0.75rem;
      border-radius: 12px;
      background: #e7f3ff;
      color: #0066cc;
    }
    .diary-zone.friends {
      background: #fff3cd;
      color: #856404;
    }
    .diary-content {
      margin-bottom: 0.75rem;
    }
    .diary-content-item {
      margin-bottom: 0.75rem;
    }
    .diary-content-item:last-child {
      margin-bottom: 0;
    }
    .diary-question {
      font-size: 0.85rem;
      color: #6c757d;
      margin-bottom: 0.25rem;
    }
    .diary-answer {
      color: #333;
      font-size: 0.95rem;
      line-height: 1.6;
    }
    .diary-actions {
      display: flex;
      gap: 0.5rem;
      margin-top: 0.75rem;
      padding-top: 0.75rem;
      border-top: 1px solid #f0f0f0;
    }
    .section-divider {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 0.75rem 1rem;
      margin: 1rem -1rem;
      font-weight: 600;
      font-size: 0.95rem;
      position: sticky;
      top: 139px;
      z-index: 98;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    .info-box {
      background: #e7f3ff;
      border-left: 4px solid #0066cc;
      padding: 1rem;
      margin-bottom: 1rem;
      border-radius: 8px;
      font-size: 0.9rem;
      color: #004085;
    }
    .info-box.warning {
      background: #fff3cd;
      border-left-color: #856404;
      color: #856404;
    }
    .debug-box {
      background: #fff3cd;
      border-left: 4px solid #ff9800;
      padding: 1rem;
      margin-bottom: 1rem;
      border-radius: 8px;
      font-size: 0.85rem;
      color: #856404;
    }
    .debug-box div {
      margin-bottom: 0.25rem;
    }
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.5);
      z-index: 1000;
      justify-content: center;
      align-items: center;
      animation: fadeIn 0.2s;
    }
    .modal.active {
      display: flex;
    }
    .modal-content {
      background: white;
      padding: 2rem;
      border-radius: 12px;
      max-width: 500px;
      width: 90%;
      max-height: 80vh;
      overflow-y: auto;
      box-shadow: 0 10px 40px rgba(0,0,0,0.3);
      animation: slideUp 0.3s;
    }
    @keyframes slideUp {
      from { transform: translateY(50px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }
    .modal-header {
      font-size: 1.25rem;
      font-weight: 600;
      margin-bottom: 1.5rem;
      color: #333;
    }
    .modal-actions {
      display: flex;
      gap: 0.75rem;
      margin-top: 1.5rem;
    }
    .modal-actions button {
      flex: 1;
    }
    .empty-state {
      text-align: center;
      padding: 3rem 1rem;
      color: #6c757d;
    }
    .empty-state-icon {
      font-size: 3rem;
      margin-bottom: 1rem;
      opacity: 0.5;
    }
    .empty-state-text {
      font-size: 1rem;
    }
    .filter-group {
      display: flex;
      gap: 0.5rem;
      margin-bottom: 1rem;
      padding: 1rem;
      background: #f8f9fa;
      border-radius: 8px;
    }
    .filter-group select {
      flex: 1;
      padding: 0.5rem;
      border: 2px solid #e9ecef;
      border-radius: 6px;
      font-size: 0.9rem;
    }
    .notification {
      position: fixed;
      top: 90px;
      left: 50%;
      transform: translateX(-50%);
      padding: 1rem 1.5rem;
      border-radius: 8px;
      color: white;
      font-weight: 500;
      z-index: 10000;
      animation: slideDown 0.3s;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      max-width: 90%;
    }
    @keyframes slideDown {
      from { transform: translate(-50%, -100%); opacity: 0; }
      to { transform: translate(-50%, 0); opacity: 1; }
    }
    .notification.success {
      background: #28a745;
    }
    .notification.error {
      background: #dc3545;
    }
    .questions-list {
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }
    .question-item {
      background: #f8f9fa;
      padding: 1rem;
      border-radius: 8px;
      border-left: 3px solid #667eea;
    }
    .question-text {
      font-weight: 500;
      margin-bottom: 0.5rem;
      color: #495057;
    }
    .answer-input {
      width: 100%;
      padding: 0.75rem;
      border: 2px solid #e9ecef;
      border-radius: 6px;
      font-size: 0.95rem;
      font-family: inherit;
      min-height: 80px;
      resize: vertical;
    }
    .answer-input:focus {
      outline: none;
      border-color: #667eea;
    }
    .nickname-manager {
      background: #f8f9fa;
      padding: 1rem;
      border-radius: 8px;
      margin-bottom: 1rem;
    }
    .nickname-list {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      margin-top: 0.75rem;
    }
    .nickname-tag {
      padding: 0.5rem 1rem;
      background: white;
      border: 2px solid #e9ecef;
      border-radius: 20px;
      font-size: 0.9rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    .nickname-tag.active {
      background: #667eea;
      color: white;
      border-color: #667eea;
    }
    .nickname-tag button {
      background: none;
      border: none;
      color: inherit;
      cursor: pointer;
      font-size: 1rem;
      padding: 0;
      opacity: 0.7;
    }
    .nickname-tag button:hover {
      opacity: 1;
    }
    .read-more {
      color: #667eea;
      cursor: pointer;
      font-size: 0.9rem;
      margin-top: 0.5rem;
      display: inline-block;
    }
    .read-more:hover {
      text-decoration: underline;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>ğŸ“” ä»Šæ—¥ã®æ—¥è¨˜</h1>
      <div class="version" id="versionDisplay">v0.0.22</div>
    </div>

    <div class="tabs">
      <button class="tab active" data-tab="write">ğŸ“ æ›¸ã</button>
      <button class="tab" data-tab="feed">ğŸŒ ã¿ã‚“ãªã®è¨˜éŒ²</button>
      <button class="tab" data-tab="mydiary">ğŸ“– ãƒã‚¤æ—¥è¨˜</button>
      <button class="tab" data-tab="settings">âš™ï¸ ãƒã‚¤ãƒšãƒ¼ã‚¸</button>
    </div>

    <div class="content">
      <!-- æ›¸ãã‚¿ãƒ– -->
      <div class="tab-content active" id="writeTab">
        <div class="info-box">
          æ¯æ—¥ã®æ°—æŒã¡ã‚„å‡ºæ¥äº‹ã‚’è¨˜éŒ²ã—ã¾ã—ã‚‡ã† ğŸ’­
        </div>

        <div class="form-group">
          <label>ä»Šæ—¥ã®æ°—åˆ†ã¯ï¼Ÿ</label>
          <div class="mood-chips" id="moodChips">
            <div class="mood-chip" data-mood="ğŸ˜Š æœ€é«˜">ğŸ˜Š æœ€é«˜</div>
            <div class="mood-chip" data-mood="ğŸ™‚ è‰¯ã„">ğŸ™‚ è‰¯ã„</div>
            <div class="mood-chip" data-mood="ğŸ˜ æ™®é€š">ğŸ˜ æ™®é€š</div>
            <div class="mood-chip" data-mood="ğŸ˜” ã‚¤ãƒã‚¤ãƒ">ğŸ˜” ã‚¤ãƒã‚¤ãƒ</div>
            <div class="mood-chip" data-mood="ğŸ˜¢ è¾›ã„">ğŸ˜¢ è¾›ã„</div>
          </div>
        </div>

        <div class="questions-list" id="questionsList">
          <div class="question-item">
            <div class="question-text">ä»Šæ—¥ã¯ã©ã‚“ãªä¸€æ—¥ã§ã—ãŸã‹ï¼Ÿ</div>
            <textarea class="answer-input" data-question="ä»Šæ—¥ã¯ã©ã‚“ãªä¸€æ—¥ã§ã—ãŸã‹ï¼Ÿ" placeholder="è‡ªç”±ã«æ›¸ã„ã¦ãã ã•ã„..."></textarea>
          </div>
          <div class="question-item">
            <div class="question-text">ä»Šæ—¥ä¸€ç•ªå°è±¡ã«æ®‹ã£ãŸã“ã¨ã¯ï¼Ÿ</div>
            <textarea class="answer-input" data-question="ä»Šæ—¥ä¸€ç•ªå°è±¡ã«æ®‹ã£ãŸã“ã¨ã¯ï¼Ÿ" placeholder="è‡ªç”±ã«æ›¸ã„ã¦ãã ã•ã„..."></textarea>
          </div>
          <div class="question-item">
            <div class="question-text">æ˜æ—¥ã‚„ã‚ŠãŸã„ã“ã¨ã¯ï¼Ÿ</div>
            <textarea class="answer-input" data-question="æ˜æ—¥ã‚„ã‚ŠãŸã„ã“ã¨ã¯ï¼Ÿ" placeholder="è‡ªç”±ã«æ›¸ã„ã¦ãã ã•ã„..."></textarea>
          </div>
        </div>

        <div class="form-group">
          <label>å…¬é–‹ç¯„å›²</label>
          <select id="zoneSelect">
            <option value="public">ğŸŒ å…¨ä¸–ç•Œã«å…¬é–‹</option>
            <option value="friends">ğŸ‘¥ å‹é”ã®ã¿</option>
          </select>
        </div>

        <button class="btn-primary" id="submitBtn">é€ä¿¡ã™ã‚‹</button>
      </div>

      <!-- ã¿ã‚“ãªã®è¨˜éŒ²ã‚¿ãƒ– -->
      <div class="tab-content" id="feedTab">
        <div class="info-box">
          ä»Šæ—¥ã®åŒºåˆ‡ã‚Šï¼šæ˜¼12:00ï¼ˆ12:00ã€œç¿Œ11:59ï¼‰
        </div>
        <div class="filter-group">
          <select id="feedZoneFilter">
            <option value="public">ğŸŒ å…¨ä¸–ç•Œ</option>
            <option value="friends">ğŸ‘¥ å‹é”</option>
          </select>
        </div>
        <div id="feedContent">
          <div class="empty-state">
            <div class="empty-state-icon">ğŸ“­</div>
            <div class="empty-state-text">ã¾ã æŠ•ç¨¿ãŒã‚ã‚Šã¾ã›ã‚“</div>
          </div>
        </div>
      </div>

      <!-- ãƒã‚¤æ—¥è¨˜ã‚¿ãƒ– -->
      <div class="tab-content" id="mydiaryTab">
        <div class="debug-box" id="debugBox">
          <strong>ğŸ” ãƒ‡ãƒãƒƒã‚°æƒ…å ±</strong>
          <div id="debugContent">èª­ã¿è¾¼ã¿ä¸­...</div>
        </div>
        <div class="filter-group">
          <select id="nicknameFilter">
            <option value="all">ã™ã¹ã¦ã®ãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ </option>
          </select>
        </div>
        <div id="mydiaryContent">
          <div class="empty-state">
            <div class="empty-state-icon">ğŸ“­</div>
            <div class="empty-state-text">ã¾ã æ—¥è¨˜ãŒã‚ã‚Šã¾ã›ã‚“</div>
          </div>
        </div>
      </div>

      <!-- è¨­å®šã‚¿ãƒ– -->
      <div class="tab-content" id="settingsTab">
        <div class="info-box">
          ãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ ã¯è¤‡æ•°ç™»éŒ²ã§ãã¾ã™ã€‚æŠ•ç¨¿æ™‚ã«é¸æŠã—ãŸãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ ãŒä½¿ç”¨ã•ã‚Œã¾ã™ã€‚
        </div>

        <div class="nickname-manager">
          <label style="display: block; margin-bottom: 0.75rem; font-weight: 600;">ãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ ç®¡ç†</label>
          <div class="nickname-list" id="nicknameList"></div>
          <div style="display: flex; gap: 0.5rem; margin-top: 1rem;">
            <input type="text" id="newNicknameInput" placeholder="æ–°ã—ã„ãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ " style="flex: 1; padding: 0.5rem; border: 2px solid #e9ecef; border-radius: 6px;">
            <button class="btn-secondary" id="addNicknameBtn">è¿½åŠ </button>
          </div>
        </div>

        <div class="form-group" style="margin-top: 1.5rem;">
          <button class="btn-danger" id="clearHiddenBtn">è¦‹ãŸç›®å‰Šé™¤ã‚’å…¨è§£é™¤</button>
          <p style="font-size: 0.85rem; color: #6c757d; margin-top: 0.5rem;">éè¡¨ç¤ºã«ã—ãŸæ—¥è¨˜ã‚’ã™ã¹ã¦è¡¨ç¤ºã«æˆ»ã—ã¾ã™</p>
        </div>

        <div class="form-group" style="margin-top: 1.5rem;">
          <button class="btn-secondary" id="clearCacheBtn">ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ã‚¯ãƒªã‚¢</button>
          <p style="font-size: 0.85rem; color: #6c757d; margin-top: 0.5rem;">è¡¨ç¤ºãŒæ­£ã—ããªã„å ´åˆã«ãŠè©¦ã—ãã ã•ã„</p>
        </div>

        <div style="margin-top: 2rem; padding: 1rem; background: #f8f9fa; border-radius: 8px; font-size: 0.85rem; color: #6c757d;">
          <strong style="display: block; margin-bottom: 0.5rem; color: #495057;">ğŸ“Œ Changelog</strong>
          <div style="line-height: 1.8;">
            <div>(2026-01-18) v0.0.22 Apps Script é€ä¿¡ã‚’ no-cors çµ±ä¸€ / æ°—åˆ†é¸æŠã‚’é¸æŠå¼ã«æˆ»ã™</div>
            <div>(2026-01-18) v0.0.21 ãƒã‚¤æ—¥è¨˜ã®è¡¨ç¤ºä¸å…·åˆä¿®æ­£ / ç·¨é›†ãƒ»è¦‹ãŸç›®å‰Šé™¤ã‚’è¿½åŠ </div>
            <div>(2026-01-18) v0.0.20 ãƒã‚¤æ—¥è¨˜ã®æŠ½å‡ºæ¡ä»¶ã‚’ãƒ¦ãƒ¼ã‚¶ãƒ¼IDã®ã¿ã«å¤‰æ›´</div>
            <div>(2026-01-18) v0.0.19 ç›´è¿‘3æ—¥è¡¨ç¤º / ãƒã‚¤æ—¥è¨˜ç·¨é›† / ä½™ç™½æœ€é©åŒ–</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ç·¨é›†ãƒ¢ãƒ¼ãƒ€ãƒ« -->
  <div class="modal" id="editModal">
    <div class="modal-content">
      <div class="modal-header">æ—¥è¨˜ã‚’ç·¨é›†</div>
      <div id="editFormContent"></div>
      <div class="modal-actions">
        <button class="btn-secondary" id="cancelEditBtn">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
        <button class="btn-primary" id="saveEditBtn">ä¿å­˜</button>
      </div>
    </div>
  </div>

  <script>
    // ========================================
    // Constants & Configuration
    // ========================================
    const APP_VERSION = '0.0.22';
    const BASE_URL = 'https://script.google.com/macros/s/AKfycbwHN2pvh7y1i5cEEHIWrUP_o6cMnDRCGdfurK0xrw3cVEElKtAepEDZ510JnbDdY3BI/exec';
    const SECRET = 'minnikki-2026';

    // ========================================
    // State Management
    // ========================================
    let allEntries = [];
    let currentEditingDiaryId = null;
    let selectedMood = null;

    // ========================================
    // Utility Functions
    // ========================================
    function getDeviceUserId() {
      let userId = localStorage.getItem('deviceUserId');
      if (!userId) {
        userId = 'user_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
        localStorage.setItem('deviceUserId', userId);
        console.log('ğŸ†• æ–°è¦ deviceUserId ç”Ÿæˆ:', userId);
      }
      return userId;
    }

    function getNicknames() {
      const stored = localStorage.getItem('nicknames');
      return stored ? JSON.parse(stored) : [];
    }

    function saveNicknames(nicknames) {
      localStorage.setItem('nicknames', JSON.stringify(nicknames));
    }

    function getActiveNickname() {
      return localStorage.getItem('activeNickname') || '';
    }

    function setActiveNickname(nickname) {
      localStorage.setItem('activeNickname', nickname);
    }

    function getHiddenDiaryIds() {
      const stored = localStorage.getItem('hiddenDiaryIds');
      return stored ? JSON.parse(stored) : [];
    }

    function saveHiddenDiaryIds(ids) {
      localStorage.setItem('hiddenDiaryIds', JSON.stringify(ids));
    }

    function getEditedDiaryMap() {
      const stored = localStorage.getItem('editedDiaryMap');
      return stored ? JSON.parse(stored) : {};
    }

    function saveEditedDiaryMap(map) {
      localStorage.setItem('editedDiaryMap', JSON.stringify(map));
    }

    function generateDiaryId(entry) {
      return (entry.createdAt || entry.date) + '|' + (entry.userId || '') + '|' + (entry.nickname || '');
    }

    function normalizeContent(content) {
      if (typeof content === 'string') {
        try {
          return JSON.parse(content);
        } catch (e) {
          return { _raw: content };
        }
      }
      if (typeof content === 'object' && content !== null) {
        return content;
      }
      return { _raw: String(content) };
    }

    function showNotification(message, type = 'success') {
      const notification = document.createElement('div');
      notification.className = `notification ${type}`;
      notification.textContent = message;
      document.body.appendChild(notification);
      setTimeout(() => {
        notification.remove();
      }, 3000);
    }

    function getJSTDateKey(createdAt) {
      const dt = new Date(createdAt);
      const jstOffset = 9 * 60;
      const utcTime = dt.getTime() + (dt.getTimezoneOffset() * 60000);
      const jstTime = new Date(utcTime + (jstOffset * 60000));
      
      const hours = jstTime.getHours();
      let targetDate = new Date(jstTime);
      if (hours < 12) {
        targetDate.setDate(targetDate.getDate() - 1);
      }
      
      const year = targetDate.getFullYear();
      const month = String(targetDate.getMonth() + 1).padStart(2, '0');
      const day = String(targetDate.getDate()).padStart(2, '0');
      return `${year}-${month}-${day}`;
    }

    function getLast3DaysKeys() {
      const now = new Date();
      const jstOffset = 9 * 60;
      const utcTime = now.getTime() + (now.getTimezoneOffset() * 60000);
      const jstNow = new Date(utcTime + (jstOffset * 60000));
      
      const hours = jstNow.getHours();
      let baseDate = new Date(jstNow);
      if (hours < 12) {
        baseDate.setDate(baseDate.getDate() - 1);
      }
      
      const keys = [];
      for (let i = 0; i < 3; i++) {
        const d = new Date(baseDate);
        d.setDate(d.getDate() - i);
        const year = d.getFullYear();
        const month = String(d.getMonth() + 1).padStart(2, '0');
        const day = String(d.getDate()).padStart(2, '0');
        keys.push(`${year}-${month}-${day}`);
      }
      return keys;
    }

    function getDayLabel(dateKey, index) {
      if (index === 0) return 'ä»Šæ—¥';
      if (index === 1) return 'æ˜¨æ—¥';
      if (index === 2) return 'ä¸€æ˜¨æ—¥';
      return dateKey;
    }

    // ========================================
    // API Functions
    // ========================================
    async function loadFeed() {
      try {
        console.log('ğŸ“¥ ãƒ‡ãƒ¼ã‚¿å–å¾—é–‹å§‹:', BASE_URL + '?action=list');
        
        const response = await fetch(BASE_URL + '?action=list', {
          method: 'GET',
          mode: 'cors'
        });

        if (!response.ok) {
          throw new Error('Failed to fetch: ' + response.status);
        }

        const data = await response.json();
        console.log('âœ… å–å¾—æˆåŠŸ:', data);

        if (data.result === 'ok' && Array.isArray(data.entries)) {
          allEntries = data.entries.map(entry => ({
            ...entry,
            content: normalizeContent(entry.content)
          }));
          console.log('ğŸ“Š æ­£è¦åŒ–å¾Œã‚¨ãƒ³ãƒˆãƒªæ•°:', allEntries.length);
          renderFeed();
          renderMyDiary();
        } else {
          console.error('âŒ äºˆæœŸã—ãªã„ãƒ¬ã‚¹ãƒãƒ³ã‚¹å½¢å¼:', data);
          showNotification('ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
        }
      } catch (error) {
        console.error('âŒ loadFeed ã‚¨ãƒ©ãƒ¼:', error);
        showNotification('ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + error.message, 'error');
      }
    }

    async function submitDiary() {
      const deviceUserId = getDeviceUserId();
      const activeNickname = getActiveNickname();

      if (!activeNickname) {
        showNotification('ãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ ã‚’è¨­å®šã—ã¦ãã ã•ã„', 'error');
        return;
      }

      if (!selectedMood) {
        showNotification('æ°—åˆ†ã‚’é¸æŠã—ã¦ãã ã•ã„', 'error');
        return;
      }

      const answerInputs = document.querySelectorAll('.answer-input');
      const answers = Array.from(answerInputs).map(input => ({
        question: input.dataset.question,
        answer: input.value.trim()
      })).filter(a => a.answer);

      if (answers.length === 0) {
        showNotification('å°‘ãªãã¨ã‚‚1ã¤ã®è³ªå•ã«ç­”ãˆã¦ãã ã•ã„', 'error');
        return;
      }

      const contentObject = {
        mood: selectedMood,
        answers: answers
      };

      const now = new Date();
      const dateStr = now.getFullYear() + '-' + 
                      String(now.getMonth() + 1).padStart(2, '0') + '-' + 
                      String(now.getDate()).padStart(2, '0');

      const zone = document.getElementById('zoneSelect').value;

      const payload = {
        secret: SECRET,
        userId: deviceUserId,
        nickname: activeNickname,
        content: JSON.stringify(contentObject),
        date: dateStr,
        zone: zone
      };

      const submitBtn = document.getElementById('submitBtn');
      submitBtn.disabled = true;
      submitBtn.textContent = 'é€ä¿¡ä¸­...';

      console.log('ğŸ“¤ é€ä¿¡é–‹å§‹');
      console.log('URL:', BASE_URL + '?action=submit');
      console.log('Payload:', payload);

      try {
        const response = await fetch(BASE_URL + '?action=submit', {
          method: 'POST',
          mode: 'no-cors',
          body: JSON.stringify(payload)
        });

        console.log('âœ… é€ä¿¡å®Œäº†ï¼ˆno-corsã®ãŸã‚ãƒ¬ã‚¹ãƒãƒ³ã‚¹å†…å®¹ã¯ä¸æ˜ï¼‰');
        showNotification('é€ä¿¡ã§ãã¾ã—ãŸ', 'success');

        // ãƒ•ã‚©ãƒ¼ãƒ ãƒªã‚»ãƒƒãƒˆ
        selectedMood = null;
        document.querySelectorAll('.mood-chip').forEach(chip => chip.classList.remove('selected'));
        answerInputs.forEach(input => input.value = '');

        // ãƒ‡ãƒ¼ã‚¿å†å–å¾—
        setTimeout(() => {
          loadFeed();
        }, 1000);

      } catch (error) {
        console.error('âŒ é€ä¿¡ã‚¨ãƒ©ãƒ¼:', error);
        showNotification('é€ä¿¡ã§ãã¦ã„ã¾ã›ã‚“: ' + error.message, 'error');
      } finally {
        submitBtn.disabled = false;
        submitBtn.textContent = 'é€ä¿¡ã™ã‚‹';
      }
    }

    // ========================================
    // Rendering Functions
    // ========================================
    function renderFeed() {
      const feedZone = document.getElementById('feedZoneFilter').value;
      const deviceUserId = getDeviceUserId();
      const activeNickname = getActiveNickname();
      const last3Days = getLast3DaysKeys();

      console.log('ğŸ” ã¿ã‚“ãªã®è¨˜éŒ²ãƒ•ã‚£ãƒ«ã‚¿:', { feedZone, last3Days });

      const filtered = allEntries.filter(entry => {
        if (entry.zone !== feedZone) return false;
        if (String(entry.userId || '') === String(deviceUserId) && entry.nickname === activeNickname) {
          return false;
        }
        const entryDateKey = getJSTDateKey(entry.createdAt || entry.date);
        return last3Days.includes(entryDateKey);
      });

      console.log('ğŸ“Š ãƒ•ã‚£ãƒ«ã‚¿å¾Œ:', filtered.length, 'ä»¶');

      const grouped = {};
      last3Days.forEach(key => { grouped[key] = []; });

      filtered.forEach(entry => {
        const key = getJSTDateKey(entry.createdAt || entry.date);
        if (grouped[key]) {
          grouped[key].push(entry);
        }
      });

      let html = '';
      last3Days.forEach((key, index) => {
        const entries = grouped[key];
        if (entries.length > 0) {
          html += `<div class="section-divider">${getDayLabel(key, index)} (${key})</div>`;
          entries.forEach(entry => {
            html += renderDiaryCard(entry, false);
          });
        }
      });

      const feedContent = document.getElementById('feedContent');
      if (html) {
        feedContent.innerHTML = html;
      } else {
        feedContent.innerHTML = `
          <div class="empty-state">
            <div class="empty-state-icon">ğŸ“­</div>
            <div class="empty-state-text">ã¾ã æŠ•ç¨¿ãŒã‚ã‚Šã¾ã›ã‚“</div>
          </div>
        `;
      }
    }

    function renderMyDiary() {
      const deviceUserId = getDeviceUserId();
      const activeNickname = getActiveNickname();
      const selectedNickname = document.getElementById('nicknameFilter').value;
      const hiddenIds = getHiddenDiaryIds();
      const editedMap = getEditedDiaryMap();

      console.log('ğŸ” ãƒã‚¤æ—¥è¨˜ãƒ‡ãƒãƒƒã‚°');
      console.log('deviceUserId:', deviceUserId);
      console.log('activeNickname:', activeNickname);
      console.log('entriesç·æ•°:', allEntries.length);

      let myEntries = allEntries.filter(entry => {
        return String(entry.userId || '') === String(deviceUserId);
      });

      console.log('userIdä¸€è‡´:', myEntries.length, 'ä»¶');
      if (myEntries.length > 0) {
        console.log('å…ˆé ­3ä»¶ã®userId:', myEntries.slice(0, 3).map((e, i) => `[${i}] ${e.userId}`));
      }

      if (selectedNickname !== 'all') {
        myEntries = myEntries.filter(entry => entry.nickname === selectedNickname);
        console.log('nicknameçµã‚Šè¾¼ã¿å¾Œ:', myEntries.length, 'ä»¶');
      }

      myEntries = myEntries.filter(entry => {
        const diaryId = generateDiaryId(entry);
        return !hiddenIds.includes(diaryId);
      });

      console.log('hiddené™¤å¤–å¾Œ:', myEntries.length, 'ä»¶');

      // ãƒ‡ãƒãƒƒã‚°è¡¨ç¤ºæ›´æ–°
      const debugContent = document.getElementById('debugContent');
      const nicknames = getNicknames();
      const last3Days = getLast3DaysKeys();
      
      // candidateUserId æ¤œå‡ºãƒ­ã‚¸ãƒƒã‚¯
      let candidateUserId = null;
      let shouldShowRestore = false;
      
      if (allEntries.length > 0 && myEntries.length === 0) {
        const nicknameSet = new Set(nicknames);
        const myNicknameEntries = allEntries.filter(e => nicknameSet.has(e.nickname));
        
        if (myNicknameEntries.length > 0) {
          const userIdCounts = {};
          myNicknameEntries.forEach(e => {
            const uid = e.userId || '';
            userIdCounts[uid] = (userIdCounts[uid] || 0) + 1;
          });
          
          let maxCount = 0;
          Object.entries(userIdCounts).forEach(([uid, count]) => {
            if (count > maxCount) {
              maxCount = count;
              candidateUserId = uid;
            }
          });
          
          if (candidateUserId && candidateUserId.startsWith('device_')) {
            shouldShowRestore = true;
          }
        }
      }

      debugContent.innerHTML = `
        <div><strong>deviceUserId:</strong> ${deviceUserId}</div>
        <div><strong>activeNickname:</strong> ${activeNickname || '(æœªè¨­å®š)'}</div>
        <div><strong>entriesç·æ•°:</strong> ${allEntries.length}</div>
        <div><strong>userIdä¸€è‡´:</strong> ${myEntries.length} ä»¶</div>
        ${myEntries.length > 0 ? `<div><strong>å…ˆé ­3ä»¶userId:</strong> ${myEntries.slice(0, 3).map((e, i) => `[${i}] ${e.userId}`).join(', ')}</div>` : ''}
        <div><strong>last3Days:</strong> ${last3Days.join(', ')}</div>
        <div><strong>candidateUserId:</strong> ${candidateUserId || '(ãªã—)'}</div>
        <div><strong>å¾©å…ƒææ¡ˆ:</strong> ${shouldShowRestore ? 'ã‚ã‚Š' : 'ãªã—'}</div>
      `;

      // è‡ªå‹•å¾©å…ƒãƒ€ã‚¤ã‚¢ãƒ­ã‚°
      if (shouldShowRestore && candidateUserId) {
        const confirmed = confirm(
          `éå»ã®æŠ•ç¨¿ãƒ‡ãƒ¼ã‚¿ï¼ˆ${candidateUserId}ï¼‰ãŒè¦‹ã¤ã‹ã‚Šã¾ã—ãŸã€‚\n` +
          `ã“ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼IDã«å¾©å…ƒã—ã¾ã™ã‹ï¼Ÿ\n\n` +
          `OK: å¾©å…ƒã—ã¦ãƒšãƒ¼ã‚¸ã‚’å†èª­ã¿è¾¼ã¿\n` +
          `ã‚­ãƒ£ãƒ³ã‚»ãƒ«: ä½•ã‚‚ã—ãªã„`
        );
        if (confirmed) {
          localStorage.setItem('deviceUserId', candidateUserId);
          console.log('âœ… deviceUserId å¾©å…ƒ:', candidateUserId);
          location.reload();
          return;
        }
      }

      let html = '';
      myEntries.forEach(entry => {
        const diaryId = generateDiaryId(entry);
        if (editedMap[diaryId]) {
          entry = { ...entry, content: editedMap[diaryId] };
        }
        html += renderDiaryCard(entry, true);
      });

      const mydiaryContent = document.getElementById('mydiaryContent');
      if (html) {
        mydiaryContent.innerHTML = html;
      } else {
        mydiaryContent.innerHTML = `
          <div class="empty-state">
            <div class="empty-state-icon">ğŸ“­</div>
            <div class="empty-state-text">ã¾ã æ—¥è¨˜ãŒã‚ã‚Šã¾ã›ã‚“</div>
          </div>
        `;
      }
    }

    function renderDiaryCard(entry, isMyDiary) {
      const content = entry.content || {};
      const mood = content.mood || '';
      const answers = content.answers || [];
      const diaryId = generateDiaryId(entry);

      const displayAnswers = answers.slice(0, 3);
      const hasMore = answers.length > 3;

      let answersHtml = '';
      displayAnswers.forEach(item => {
        if (item.question && item.answer) {
          answersHtml += `
            <div class="diary-content-item">
              <div class="diary-question">${item.question}</div>
              <div class="diary-answer">${item.answer}</div>
            </div>
          `;
        }
      });

      if (hasMore) {
        answersHtml += `<div class="read-more" onclick="alert('å…¨æ–‡è¡¨ç¤ºæ©Ÿèƒ½ã¯ä»Šå¾Œå®Ÿè£…äºˆå®šã§ã™')">ç¶šãã‚’èª­ã‚€ (${answers.length - 3}ä»¶)</div>`;
      }

      let actionsHtml = '';
      if (isMyDiary) {
        actionsHtml = `
          <div class="diary-actions">
            <button class="btn-secondary" onclick="editDiary('${diaryId}')">âœï¸ ç·¨é›†</button>
            <button class="btn-danger" onclick="hideDiary('${diaryId}')">ğŸ—‘ï¸ å‰Šé™¤ï¼ˆè¦‹ãŸç›®ï¼‰</button>
          </div>
        `;
      }

      return `
        <div class="diary-card">
          <div class="diary-header">
            <div class="diary-meta">
              <div class="diary-nickname">${entry.nickname || 'åŒ¿å'}</div>
              <div class="diary-date">${entry.date || ''} ${mood}</div>
            </div>
            <div class="diary-zone ${entry.zone === 'friends' ? 'friends' : ''}">${entry.zone === 'friends' ? 'ğŸ‘¥ å‹é”' : 'ğŸŒ å…¨ä¸–ç•Œ'}</div>
          </div>
          <div class="diary-content">
            ${answersHtml}
          </div>
          ${actionsHtml}
        </div>
      `;
    }

    function renderNicknameList() {
      const nicknames = getNicknames();
      const activeNickname = getActiveNickname();
      const nicknameList = document.getElementById('nicknameList');
      const nicknameFilter = document.getElementById('nicknameFilter');

      if (nicknames.length === 0) {
        nicknameList.innerHTML = '<div style="color: #6c757d; font-size: 0.9rem;">ãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ ãŒç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“</div>';
        nicknameFilter.innerHTML = '<option value="all">ã™ã¹ã¦ã®ãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ </option>';
        return;
      }

      let listHtml = '';
      nicknames.forEach(nickname => {
        const isActive = nickname === activeNickname;
        listHtml += `
          <div class="nickname-tag ${isActive ? 'active' : ''}" onclick="setActiveNickname('${nickname}')">
            ${nickname} ${isActive ? 'âœ“' : ''}
            <button onclick="event.stopPropagation(); removeNickname('${nickname}')">Ã—</button>
          </div>
        `;
      });
      nicknameList.innerHTML = listHtml;

      let filterHtml = '<option value="all">ã™ã¹ã¦ã®ãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ </option>';
      nicknames.forEach(nickname => {
        filterHtml += `<option value="${nickname}">${nickname}</option>`;
      });
      nicknameFilter.innerHTML = filterHtml;
    }

    // ========================================
    // Event Handlers
    // ========================================
    function editDiary(diaryId) {
      const entry = allEntries.find(e => generateDiaryId(e) === diaryId);
      if (!entry) return;

      currentEditingDiaryId = diaryId;
      const editedMap = getEditedDiaryMap();
      const content = editedMap[diaryId] || entry.content || {};
      const answers = content.answers || [];

      let formHtml = '';
      answers.forEach((item, index) => {
        formHtml += `
          <div class="question-item">
            <div class="question-text">${item.question}</div>
            <textarea class="answer-input" data-index="${index}">${item.answer}</textarea>
          </div>
        `;
      });

      document.getElementById('editFormContent').innerHTML = formHtml;
      document.getElementById('editModal').classList.add('active');
    }

    function saveEdit() {
      if (!currentEditingDiaryId) return;

      const inputs = document.querySelectorAll('#editFormContent .answer-input');
      const editedMap = getEditedDiaryMap();
      const entry = allEntries.find(e => generateDiaryId(e) === currentEditingDiaryId);
      
      if (!entry) return;

      const content = editedMap[currentEditingDiaryId] || entry.content || {};
      const answers = content.answers || [];

      inputs.forEach(input => {
        const index = parseInt(input.dataset.index);
        if (answers[index]) {
          answers[index].answer = input.value.trim();
        }
      });

      editedMap[currentEditingDiaryId] = {
        ...content,
        answers: answers
      };

      saveEditedDiaryMap(editedMap);
      document.getElementById('editModal').classList.remove('active');
      currentEditingDiaryId = null;

      showNotification('ç·¨é›†ã‚’ä¿å­˜ã—ã¾ã—ãŸ', 'success');
      renderMyDiary();
    }

    function hideDiary(diaryId) {
      if (!confirm('ã“ã®æ—¥è¨˜ã‚’éè¡¨ç¤ºã«ã—ã¾ã™ã‹ï¼Ÿ\nï¼ˆãƒ‡ãƒ¼ã‚¿ã¯æ®‹ã£ã¦ã„ã¦ã€è¨­å®šã‹ã‚‰å¾©å…ƒã§ãã¾ã™ï¼‰')) {
        return;
      }

      const hiddenIds = getHiddenDiaryIds();
      if (!hiddenIds.includes(diaryId)) {
        hiddenIds.push(diaryId);
        saveHiddenDiaryIds(hiddenIds);
      }

      showNotification('æ—¥è¨˜ã‚’éè¡¨ç¤ºã«ã—ã¾ã—ãŸ', 'success');
      renderMyDiary();
    }

    function clearHidden() {
      if (!confirm('éè¡¨ç¤ºã«ã—ãŸã™ã¹ã¦ã®æ—¥è¨˜ã‚’è¡¨ç¤ºã«æˆ»ã—ã¾ã™ã‹ï¼Ÿ')) {
        return;
      }

      saveHiddenDiaryIds([]);
      showNotification('ã™ã¹ã¦ã®æ—¥è¨˜ã‚’è¡¨ç¤ºã«æˆ»ã—ã¾ã—ãŸ', 'success');
      renderMyDiary();
    }

    function addNickname() {
      const input = document.getElementById('newNicknameInput');
      const newNickname = input.value.trim();

      if (!newNickname) {
        showNotification('ãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„', 'error');
        return;
      }

      const nicknames = getNicknames();
      if (nicknames.includes(newNickname)) {
        showNotification('ã™ã§ã«ç™»éŒ²ã•ã‚Œã¦ã„ã¾ã™', 'error');
        return;
      }

      nicknames.push(newNickname);
      saveNicknames(nicknames);

      if (nicknames.length === 1) {
        setActiveNickname(newNickname);
      }

      input.value = '';
      renderNicknameList();
      showNotification('ãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ ã‚’è¿½åŠ ã—ã¾ã—ãŸ', 'success');
    }

    function removeNickname(nickname) {
      if (!confirm(`ã€Œ${nickname}ã€ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ`)) {
        return;
      }

      let nicknames = getNicknames();
      nicknames = nicknames.filter(n => n !== nickname);
      saveNicknames(nicknames);

      if (getActiveNickname() === nickname) {
        setActiveNickname(nicknames[0] || '');
      }

      renderNicknameList();
      showNotification('ãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ ã‚’å‰Šé™¤ã—ã¾ã—ãŸ', 'success');
    }

    // ========================================
    // Initialization
    // ========================================
    document.addEventListener('DOMContentLoaded', () => {
      // Initialize deviceUserId
      const deviceUserId = getDeviceUserId();
      console.log('ğŸ”‘ deviceUserId:', deviceUserId);

      // Tab switching
      document.querySelectorAll('.tab').forEach(tab => {
        tab.addEventListener('click', () => {
          const targetTab = tab.dataset.tab;
          
          document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
          document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
          
          tab.classList.add('active');
          document.getElementById(targetTab + 'Tab').classList.add('active');

          if (targetTab === 'feed') {
            renderFeed();
          } else if (targetTab === 'mydiary') {
            renderMyDiary();
          } else if (targetTab === 'settings') {
            renderNicknameList();
          }
        });
      });

      // Mood selection
      document.querySelectorAll('.mood-chip').forEach(chip => {
        chip.addEventListener('click', () => {
          document.querySelectorAll('.mood-chip').forEach(c => c.classList.remove('selected'));
          chip.classList.add('selected');
          selectedMood = chip.dataset.mood;
        });
      });

      // Submit diary
      document.getElementById('submitBtn').addEventListener('click', submitDiary);

      // Feed zone filter
      document.getElementById('feedZoneFilter').addEventListener('change', renderFeed);

      // Nickname filter
      document.getElementById('nicknameFilter').addEventListener('change', renderMyDiary);

      // Add nickname
      document.getElementById('addNicknameBtn').addEventListener('click', addNickname);
      document.getElementById('newNicknameInput').addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
          addNickname();
        }
      });

      // Clear hidden
      document.getElementById('clearHiddenBtn').addEventListener('click', clearHidden);

      // Clear cache
      document.getElementById('clearCacheBtn').addEventListener('click', () => {
        if (confirm('ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ã‚¯ãƒªã‚¢ã—ã¦ãƒšãƒ¼ã‚¸ã‚’å†èª­ã¿è¾¼ã¿ã—ã¾ã™ã‹ï¼Ÿ')) {
          location.reload();
        }
      });

      // Edit modal
      document.getElementById('cancelEditBtn').addEventListener('click', () => {
        document.getElementById('editModal').classList.remove('active');
        currentEditingDiaryId = null;
      });

      document.getElementById('saveEditBtn').addEventListener('click', saveEdit);

      document.getElementById('editModal').addEventListener('click', (e) => {
        if (e.target.id === 'editModal') {
          document.getElementById('editModal').classList.remove('active');
          currentEditingDiaryId = null;
        }
      });

      // Initial load
      loadFeed();
      renderNicknameList();

      // Check if nickname is set
      if (!getActiveNickname()) {
        setTimeout(() => {
          if (!getActiveNickname()) {
            alert('ã¾ãšã¯ãƒã‚¤ãƒšãƒ¼ã‚¸ã§ãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ ã‚’è¨­å®šã—ã¦ãã ã•ã„');
            document.querySelector('[data-tab="settings"]').click();
          }
        }, 500);
      }
    });

    // Global functions for onclick handlers
    window.editDiary = editDiary;
    window.hideDiary = hideDiary;
    window.setActiveNickname = (nickname) => {
      setActiveNickname(nickname);
      renderNicknameList();
      showNotification(`${nickname} ã‚’ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã«ã—ã¾ã—ãŸ`, 'success');
    };
    window.removeNickname = removeNickname;
  </script>
</body>
</html>
