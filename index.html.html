<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä»Šæ—¥ã®æ—¥è¨˜</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Hiragino Sans', 'Yu Gothic', 'Meiryo', sans-serif;
            background: #f5f5f5;
            line-height: 1.6;
            color: #333;
            padding-bottom: 80px;
        }

        /* ãƒ˜ãƒƒãƒ€ãƒ¼ */
        .header {
            background: white;
            padding: 20px;
            text-align: center;
            border-bottom: 1px solid #e0e0e0;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header h1 {
            font-size: 20px;
            font-weight: 600;
            color: #333;
        }

        .header p {
            font-size: 13px;
            color: #888;
            margin-top: 5px;
        }

        /* ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ */
        .nav {
            background: white;
            display: flex;
            border-bottom: 1px solid #e0e0e0;
            position: sticky;
            top: 80px;
            z-index: 99;
        }

        .nav-btn {
            flex: 1;
            padding: 15px;
            background: none;
            border: none;
            font-size: 15px;
            cursor: pointer;
            color: #888;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
        }

        .nav-btn.active {
            color: #667eea;
            border-bottom-color: #667eea;
            font-weight: 600;
        }

        /* ã‚³ãƒ³ãƒ†ãƒŠ */
        .container {
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
        }

        .page {
            display: none;
        }

        .page.active {
            display: block;
        }

        /* è³ªå•ã‚«ãƒ¼ãƒ‰ */
        .question-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .question-label {
            display: block;
            font-size: 15px;
            color: #333;
            margin-bottom: 10px;
            font-weight: 500;
        }

        .required-badge {
            display: inline-block;
            background: #ff6b6b;
            color: white;
            font-size: 11px;
            padding: 2px 8px;
            border-radius: 4px;
            margin-left: 8px;
        }

        .optional-badge {
            display: inline-block;
            background: #e0e0e0;
            color: #666;
            font-size: 11px;
            padding: 2px 8px;
            border-radius: 4px;
            margin-left: 8px;
        }

        textarea, input[type="text"] {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 15px;
            font-family: inherit;
            resize: vertical;
            min-height: 60px;
            transition: all 0.3s;
        }

        textarea:focus, input[type="text"]:focus {
            outline: none;
            border-color: #667eea;
            background: #fafbff;
        }

        /* æ°—åˆ†ã‚¿ã‚° */
        .mood-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 10px;
        }

        .mood-tag {
            padding: 8px 16px;
            background: #f5f5f5;
            border: 2px solid #e0e0e0;
            border-radius: 20px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .mood-tag:hover {
            background: #e8ecff;
        }

        .mood-tag.selected {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        /* æŠ˜ã‚ŠãŸãŸã¿ã‚»ã‚¯ã‚·ãƒ§ãƒ³ */
        .collapsible-section {
            background: white;
            border-radius: 12px;
            margin-bottom: 15px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .section-header {
            padding: 18px 20px;
            background: #fafafa;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            user-select: none;
        }

        .section-header:active {
            background: #f0f0f0;
        }

        .section-title {
            font-size: 15px;
            font-weight: 600;
            color: #333;
        }

        .section-subtitle {
            font-size: 13px;
            color: #888;
            margin-top: 3px;
        }

        .section-arrow {
            font-size: 20px;
            color: #888;
            transition: transform 0.3s;
        }

        .section-header.expanded .section-arrow {
            transform: rotate(180deg);
        }

        .section-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }

        .section-content.expanded {
            max-height: 3000px;
        }

        .section-inner {
            padding: 20px;
        }

        /* å€‹åˆ¥è³ªå•ã®æŠ˜ã‚ŠãŸãŸã¿ */
        .question-item {
            border-bottom: 1px solid #f0f0f0;
            padding: 15px 0;
        }

        .question-item:last-child {
            border-bottom: none;
        }

        .question-toggle {
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            padding: 5px 0;
        }

        .question-text {
            font-size: 14px;
            color: #555;
            flex: 1;
        }

        .favorite-btn {
            background: none;
            border: none;
            font-size: 18px;
            cursor: pointer;
            padding: 5px;
            margin-right: 10px;
        }

        .question-arrow {
            font-size: 18px;
            color: #ccc;
            transition: transform 0.3s;
        }

        .question-toggle.expanded .question-arrow {
            transform: rotate(180deg);
        }

        .question-input-area {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }

        .question-input-area.expanded {
            max-height: 300px;
            margin-top: 10px;
        }

        /* ãƒœã‚¿ãƒ³ */
        .btn {
            width: 100%;
            padding: 16px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:active {
            transform: scale(0.98);
        }

        .btn-secondary {
            background: white;
            color: #667eea;
            border: 2px solid #667eea;
        }

        .save-btn-container {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            padding: 15px 20px;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
            z-index: 100;
        }

        /* å…±æœ‰è¨­å®š */
        .share-settings {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .share-toggle {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #f0f0f0;
        }

        .toggle-switch {
            position: relative;
            width: 50px;
            height: 28px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .3s;
            border-radius: 28px;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 20px;
            width: 20px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .3s;
            border-radius: 50%;
        }

        input:checked + .toggle-slider {
            background-color: #667eea;
        }

        input:checked + .toggle-slider:before {
            transform: translateX(22px);
        }

        .share-options {
            display: none;
        }

        .share-options.visible {
            display: block;
        }

        .share-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid #f5f5f5;
        }

        .share-item:last-child {
            border-bottom: none;
        }

        .share-item-label {
            font-size: 14px;
            color: #555;
        }

        /* ã‚¾ãƒ¼ãƒ³é¸æŠ */
        .zone-selector {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .zone-btn {
            flex: 1;
            padding: 10px;
            border: 2px solid #e0e0e0;
            background: white;
            border-radius: 8px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .zone-btn.selected {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        /* åŒ¿åæ€§é¸æŠ */
        .anonymity-selector {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .anonymity-btn {
            flex: 1;
            padding: 10px;
            border: 2px solid #e0e0e0;
            background: white;
            border-radius: 8px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .anonymity-btn.selected {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        /* ãƒ•ã‚£ãƒ¼ãƒ‰ */
        .feed-item {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .feed-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #f0f0f0;
        }

        .feed-author {
            font-size: 14px;
            color: #888;
        }

        .feed-date {
            font-size: 13px;
            color: #aaa;
        }

        .feed-content {
            margin-bottom: 15px;
        }

        .feed-question {
            margin-bottom: 12px;
        }

        .feed-question-title {
            font-size: 13px;
            color: #888;
            margin-bottom: 5px;
        }

        .feed-question-answer {
            font-size: 15px;
            color: #333;
            line-height: 1.6;
        }

        .feed-reactions {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            padding-top: 10px;
            border-top: 1px solid #f0f0f0;
        }

        .reaction-btn {
            padding: 8px 14px;
            background: #f5f5f5;
            border: none;
            border-radius: 20px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .reaction-btn:hover {
            background: #e8ecff;
        }

        .reaction-btn.sent {
            background: #667eea;
            color: white;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #999;
        }

        .empty-state-icon {
            font-size: 48px;
            margin-bottom: 15px;
        }

        .empty-state-text {
            font-size: 15px;
            line-height: 1.8;
        }

        /* ãƒ©ãƒ³ãƒ€ãƒ è³ªå•ã‚«ãƒ¼ãƒ‰ */
        .random-question-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            border: 1px solid #e8e8e8;
        }

        .random-question-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 10px;
        }

        .random-question-title {
            font-size: 14px;
            font-weight: 500;
            color: #666;
        }

        .random-question-text-display {
            font-size: 15px;
            color: #333;
            margin-bottom: 12px;
            line-height: 1.5;
        }

        /* ãŠæ°—ã«å…¥ã‚Šè³ªå• */
        .favorite-questions {
            background: #fffbf0;
            border: 2px solid #ffe4a3;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
        }

        .favorite-title {
            font-size: 15px;
            font-weight: 600;
            color: #d4a500;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        /* æˆåŠŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ */
        .success-message {
            background: #d4edda;
            color: #155724;
            padding: 15px 20px;
            border-radius: 8px;
            margin-bottom: 15px;
            display: none;
            align-items: center;
            gap: 10px;
        }

        .success-message.show {
            display: flex;
        }

        /* ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ– */
        @media (max-width: 480px) {
            .container {
                padding: 15px;
            }

            .question-card, .collapsible-section {
                border-radius: 8px;
            }
        }
    </style>
</head>
<body>
    <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
    <div class="header">
        <h1>ğŸ“– ä»Šæ—¥ã®æ—¥è¨˜</h1>
        <p id="headerSubtitle">ä»Šæ—¥ã‚‚ãŠã¤ã‹ã‚Œã•ã¾ã§ã™</p>
    </div>

    <!-- ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ -->
    <div class="nav">
        <button class="nav-btn active" onclick="switchPage('write')">æ›¸ã</button>
        <button class="nav-btn" onclick="switchPage('feed')" id="feedNavBtn">ã¿ã‚“ãªã®æ—¥è¨˜</button>
    </div>

    <!-- ã‚³ãƒ³ãƒ†ãƒŠ -->
    <div class="container">
        <!-- æ›¸ããƒšãƒ¼ã‚¸ -->
        <div id="writePage" class="page active">
            <!-- æˆåŠŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ -->
            <div class="success-message" id="successMessage">
                <span>âœ…</span>
                <span id="successMessageText">æ—¥è¨˜ã‚’ä¿å­˜ã—ã¾ã—ãŸï¼</span>
            </div>

            <!-- åå‰å…¥åŠ›æ¬„ -->
            <div class="question-card">
                <label class="question-label">
                    åå‰ï¼ˆè¡¨ç¤ºç”¨ï¼‰<span class="optional-badge">ä»»æ„</span>
                </label>
                <input type="text" id="userName" placeholder="æœªå…¥åŠ›ã®å ´åˆã¯åŒ¿åè¡¨ç¤ºã«ãªã‚Šã¾ã™" />
            </div>

            <!-- å¿…é ˆè³ªå• -->
            <div class="question-card">
                <label class="question-label">
                    Q1: ä»Šã®æ°—åˆ†ã¯ï¼Ÿ<span class="required-badge">å¿…é ˆ</span>
                </label>
                <input type="text" id="mood" placeholder="ä¸€è¨€ã§è¡¨ã™ã¨..." />
                <div class="mood-tags">
                    <div class="mood-tag" onclick="selectMood(this, 'ğŸ˜Š ã‚ˆã„')">ğŸ˜Š ã‚ˆã„</div>
                    <div class="mood-tag" onclick="selectMood(this, 'ğŸ˜Œ ã¾ã‚ã¾ã‚')">ğŸ˜Œ ã¾ã‚ã¾ã‚</div>
                    <div class="mood-tag" onclick="selectMood(this, 'ğŸ˜ ãµã¤ã†')">ğŸ˜ ãµã¤ã†</div>
                    <div class="mood-tag" onclick="selectMood(this, 'ğŸ˜” ã—ã‚“ã©ã„')">ğŸ˜” ã—ã‚“ã©ã„</div>
                    <div class="mood-tag" onclick="selectMood(this, 'ğŸ˜¤ ãƒ¢ãƒ¤ãƒ¢ãƒ¤')">ğŸ˜¤ ãƒ¢ãƒ¤ãƒ¢ãƒ¤</div>
                    <div class="mood-tag" onclick="selectMood(this, 'ğŸ¤” ã‚ˆãã‚ã‹ã‚‰ã‚“')">ğŸ¤” ã‚ˆãã‚ã‹ã‚‰ã‚“</div>
                </div>
            </div>

            <div class="question-card">
                <label class="question-label">
                    Q2: ä»Šæ—¥ã„ã¡ã°ã‚“æ®‹ã—ãŸã„ã“ã¨ã¯ï¼Ÿ<span class="required-badge">å¿…é ˆ</span>
                </label>
                <textarea id="memorable" placeholder="è‰¯ã„ã“ã¨ã€æ‚ªã„ã“ã¨ã€ã©ã†ã§ã‚‚ã„ã„ã“ã¨ã€ãªã‚“ã§ã‚‚OK"></textarea>
            </div>

            <div class="question-card">
                <label class="question-label">
                    Q3: ä»Šæ—¥ã®è‡ªåˆ†ã«ä¸€è¨€<span class="required-badge">å¿…é ˆ</span>
                </label>
                <textarea id="selfTalk" placeholder="è¤’ã‚ã€ã­ãã‚‰ã„ã€ãƒ„ãƒƒã‚³ãƒŸã€ãªã‚“ã§ã‚‚OK"></textarea>
            </div>

            <!-- ãŠæ°—ã«å…¥ã‚Šè³ªå• -->
            <div class="favorite-questions" id="favoriteSection" style="display: none;">
                <div class="favorite-title">â­ ã‚ˆãæ›¸ãè³ªå•</div>
                <div id="favoriteQuestionsList"></div>
            </div>

            <!-- ãƒ©ãƒ³ãƒ€ãƒ è³ªå• -->
            <div class="random-question-card">
                <div class="random-question-header">
                    <span class="random-question-title">ğŸ“‹ æ¯æ—¥ãƒ©ãƒ³ãƒ€ãƒ è³ªå•</span>
                    <span class="optional-badge">ä»»æ„</span>
                </div>
                <div class="random-question-text-display" id="randomQuestionText"></div>
                <textarea id="randomAnswer" placeholder="ç­”ãˆã¦ã¿ã‚‹ï¼ˆä»»æ„ï¼‰"></textarea>
            </div>

            <!-- ä»»æ„è³ªå•ï¼ˆã‚¯ã‚¤ãƒƒã‚¯ï¼‰ -->
            <div class="collapsible-section">
                <div class="section-header" onclick="toggleSection(this)">
                    <div>
                        <div class="section-title">ã•ã£ã¨æ›¸ããŸã„äººã ã‘</div>
                        <div class="section-subtitle">æ°—è»½ã«æ›¸ã‘ã‚‹è³ªå•ãŸã¡</div>
                    </div>
                    <span class="section-arrow">â–¼</span>
                </div>
                <div class="section-content">
                    <div class="section-inner" id="quickQuestions"></div>
                </div>
            </div>

            <!-- ä»»æ„è³ªå•ï¼ˆãƒ‡ã‚£ãƒ¼ãƒ—ï¼‰ -->
            <div class="collapsible-section">
                <div class="section-header" onclick="toggleSection(this)">
                    <div>
                        <div class="section-title">ã¡ã‚‡ã£ã¨è€ƒãˆãŸã„äººã ã‘</div>
                        <div class="section-subtitle">å†…é¢ã«è§¦ã‚Œã‚‹è³ªå•ãŸã¡</div>
                    </div>
                    <span class="section-arrow">â–¼</span>
                </div>
                <div class="section-content">
                    <div class="section-inner" id="deepQuestions"></div>
                </div>
            </div>

            <!-- å…±æœ‰è¨­å®š -->
            <div class="share-settings">
                <div class="share-toggle">
                    <div>
                        <div style="font-weight: 600; margin-bottom: 5px;">ã“ã®æ—¥è¨˜ã‚’å…±æœ‰ã™ã‚‹</div>
                        <div style="font-size: 13px; color: #888;">æ›¸ã„ãŸäººã ã‘ãŒè¦‹ã‚‰ã‚Œã¾ã™</div>
                    </div>
                    <label class="toggle-switch">
                        <input type="checkbox" id="shareToggle" onchange="toggleShareOptions()">
                        <span class="toggle-slider"></span>
                    </label>
                </div>

                <div class="share-options" id="shareOptions">
                    <!-- ã‚¾ãƒ¼ãƒ³é¸æŠ -->
                    <div style="margin-bottom: 20px;">
                        <div style="font-size: 14px; font-weight: 500; margin-bottom: 10px;">ã©ã“ã§å…±æœ‰ã™ã‚‹ï¼Ÿ</div>
                        <div class="zone-selector">
                            <button class="zone-btn selected" onclick="selectZone(this, 'friends')">ğŸ‘¥ å‹é”ã ã‘</button>
                            <button class="zone-btn" onclick="selectZone(this, 'world')">ğŸŒ å…¨ä¸–ç•Œ</button>
                        </div>
                    </div>

                    <!-- åŒ¿åæ€§é¸æŠ -->
                    <div style="margin-bottom: 20px;">
                        <div style="font-size: 14px; font-weight: 500; margin-bottom: 10px;">åå‰ã®è¡¨ç¤º</div>
                        <div class="anonymity-selector">
                            <button class="anonymity-btn selected" onclick="selectAnonymity(this, 'real')">å®Ÿå</button>
                            <button class="anonymity-btn" onclick="selectAnonymity(this, 'nickname')">ãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ </button>
                            <button class="anonymity-btn" onclick="selectAnonymity(this, 'anonymous')">å®Œå…¨åŒ¿å</button>
                        </div>
                    </div>

                    <!-- å…±æœ‰é …ç›® -->
                    <div style="font-size: 14px; font-weight: 500; margin-bottom: 10px;">ä½•ã‚’å…±æœ‰ã™ã‚‹ï¼Ÿ</div>
                    <div class="share-item">
                        <span class="share-item-label">ä»Šã®æ°—åˆ†</span>
                        <label class="toggle-switch">
                            <input type="checkbox" id="shareMood" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    <div class="share-item">
                        <span class="share-item-label">æ®‹ã—ãŸã„ã“ã¨</span>
                        <label class="toggle-switch">
                            <input type="checkbox" id="shareMemorable" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    <div class="share-item">
                        <span class="share-item-label">è‡ªåˆ†ã«ä¸€è¨€</span>
                        <label class="toggle-switch">
                            <input type="checkbox" id="shareSelfTalk" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    <div class="share-item">
                        <span class="share-item-label">æ¯æ—¥ãƒ©ãƒ³ãƒ€ãƒ è³ªå•</span>
                        <label class="toggle-switch">
                            <input type="checkbox" id="shareRandom" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    <div class="share-item">
                        <span class="share-item-label">ä»»æ„è³ªå•ã®å›ç­”</span>
                        <label class="toggle-switch">
                            <input type="checkbox" id="shareOptional" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                </div>
            </div>
        </div>

        <!-- ã¿ã‚“ãªã®æ—¥è¨˜ãƒšãƒ¼ã‚¸ -->
        <div id="feedPage" class="page">
            <div id="feedContent"></div>
        </div>
    </div>

    <!-- ä¿å­˜ãƒœã‚¿ãƒ³ -->
    <div class="save-btn-container">
        <button class="btn btn-primary" id="saveBtn" onclick="saveDiary()">ğŸ“ ä¿å­˜ã™ã‚‹</button>
    </div>

    <script>
        // ãƒ‡ãƒ¼ã‚¿å®šç¾©ï¼ˆã‚¸ãƒ£ãƒ¼ãƒŠãƒªãƒ³ã‚°è³ªå•ã‚’å‰Šé™¤ï¼‰
        const quickQuestions = [
            "ä»Šæ—¥ã® happy",
            "ä»Šæ—¥ã®è‡ªåˆ†ã‚’è¤’ã‚ãŸã„ã¨ã“ã‚",
            "ä»Šæ—¥ã®ã‚„ã£ã¡ã¾ã£ãŸã‚¨ãƒ”ã‚½ãƒ¼ãƒ‰",
            "ä»Šæ—¥ä½•é£Ÿã¹ãŸï¼Ÿ",
            "ä»Šæ—¥ã€ã‚ã‚ŠãŒã¨ã†ã‚’ä¼ãˆãŸã„ã“ã¨",
            "ä»Šæ—¥ã®æœè£…ã‚’ä¸€è¨€ã§è¨€ã†ã¨ï¼Ÿ",
            "ä»Šæ—¥ã®ä½“èª¿ãƒ»ã‚³ãƒ³ãƒ‡ã‚£ã‚·ãƒ§ãƒ³",
            "ã¿ã‚“ãªã«ã‚·ã‚§ã‚¢ã—ãŸã„ã“ã¨",
            "æ˜æ—¥æ¥½ã—ã¿ã«ã—ã¦ã‚‹ã“ã¨",
            "æ˜æ—¥ã‚„ã‚ŠãŸã„äº‹"
        ];

        const deepQuestions = [
            "ä»Šæ—¥ã€ã„ã¡ã°ã‚“æ°—æŒã¡ãŒæºã‚ŒãŸã“ã¨ã¯ï¼Ÿ",
            "ä»Šæ—¥ã€å®‰å¿ƒã—ãŸç¬é–“ã¯ï¼Ÿ",
            "ä»Šæ—¥ã€ã¡ã‚‡ã£ã¨ç„¡ç†ã—ã¦ãŸã‹ã‚‚ã¨æ€ã†ç¬é–“ã‚ã£ãŸï¼Ÿ",
            "ä»Šæ—¥ã€æ­£ç›´ã‚ã‚“ã©ãã•ã‹ã£ãŸã“ã¨",
            "ä»Šæ—¥ã€ã‚„ã‚‰ãªãã¦ã‚ˆã‹ã£ãŸã¨æ€ã†ã“ã¨",
            "ä»Šæ—¥ã€ãªã‚“ã¨ãªãå¼•ã£ã‹ã‹ã£ã¦ã‚‹ã“ã¨",
            "ãã®å¼•ã£ã‹ã‹ã‚Šã¯ã€ä½•ãŒå¤§äº‹ã ã‹ã‚‰ã ã¨æ€ã†ï¼Ÿ",
            "ã‚‚ã—å‹ã ã¡ãŒåŒã˜1æ—¥ã‚’éã”ã—ã¦ãŸã‚‰ã€ãªã‚“ã¦å£°ã‹ã‘ã‚‹ï¼Ÿ",
            "æ˜æ—¥ã©ã†ãªã£ãŸã‚‰ã¾ã‚okï¼Ÿ",
            "ä»Šæ—¥ã®è‡ªåˆ†ã«ã¨ã£ã¦ã€ã„ã¡ã°ã‚“å®ˆã‚ŠãŸã‹ã£ãŸã‚‚ã®ã¯ï¼Ÿ"
        ];

        const randomQuestionPool = [
            "ä»Šæ—¥ã‚’ä¸€è¨€ã§ã‚¿ã‚¤ãƒˆãƒ«ã«ã™ã‚‹ã¨ï¼Ÿ",
            "ä»Šæ—¥ã®BGMã¯ï¼Ÿ",
            "ä»Šæ—¥ã‚’è‰²ã§è¡¨ã™ã¨ï¼Ÿ",
            "ä»Šæ—¥ã„ã¡ã°ã‚“äººé–“ã£ã½ã‹ã£ãŸç¬é–“ã¯ï¼Ÿ",
            "ä»Šæ—¥ã®ã€Œã¾ã‚ã„ã£ã‹ã€ã¯ã©ã‚Œï¼Ÿ",
            "ä»Šæ—¥ã®LOVEã¯ï¼Ÿ",
            "ä»Šæ—¥ã„ã¡ã°ã‚“ç¬‘ã£ãŸã“ã¨",
            "ä»Šæ—¥ã®å°ã•ãªç™ºè¦‹",
            "ä»Šæ—¥ã®è‡ªåˆ†ã‚’å‹•ç‰©ã«ä¾‹ãˆã‚‹ã¨ï¼Ÿ"
        ];

        // çŠ¶æ…‹ç®¡ç†
        let currentPage = 'write';
        let selectedZone = 'friends';
        let selectedAnonymity = 'real';
        let favorites = JSON.parse(localStorage.getItem('favorites') || '[]');
        let diaries = JSON.parse(localStorage.getItem('diaries') || '[]');
        let todayDiary = null;
        let isEditMode = false;

        // åˆæœŸåŒ–
        window.onload = function() {
            renderQuestions();
            setRandomQuestion();
            updateFavoriteSection();
            checkTodayDiary();
            updateFeedButton();
            loadUserName();
            loadTodayDiaryToForm();
        };

        // åå‰ã®èª­ã¿è¾¼ã¿
        function loadUserName() {
            const savedName = localStorage.getItem('userName');
            if (savedName) {
                document.getElementById('userName').value = savedName;
            }
        }

        // åå‰ã®ä¿å­˜
        function saveUserName() {
            const name = document.getElementById('userName').value;
            localStorage.setItem('userName', name);
        }

        // ä»Šæ—¥ã®æ—¥è¨˜ãŒã‚ã‚Œã°ãƒ•ã‚©ãƒ¼ãƒ ã«å¾©å…ƒ
        function loadTodayDiaryToForm() {
            if (!todayDiary) {
                isEditMode = false;
                document.getElementById('saveBtn').textContent = 'ğŸ“ ä¿å­˜ã™ã‚‹';
                return;
            }

            isEditMode = true;
            document.getElementById('saveBtn').textContent = 'ğŸ”„ æ›´æ–°ã™ã‚‹';

            document.getElementById('mood').value = todayDiary.mood || '';
            document.getElementById('memorable').value = todayDiary.memorable || '';
            document.getElementById('selfTalk').value = todayDiary.selfTalk || '';
            
            document.querySelectorAll('.mood-tag').forEach(tag => {
                tag.classList.remove('selected');
                if (tag.textContent === todayDiary.mood) {
                    tag.classList.add('selected');
                }
            });

            document.getElementById('randomAnswer').value = todayDiary.randomAnswer || '';

            if (todayDiary.optionalAnswers && todayDiary.optionalAnswers.length > 0) {
                todayDiary.optionalAnswers.forEach(item => {
                    const textarea = document.getElementById(item.id);
                    if (textarea) {
                        textarea.value = item.answer;
                        const questionToggle = textarea.closest('.question-item').querySelector('.question-toggle');
                        const inputArea = textarea.closest('.question-input-area');
                        if (questionToggle && inputArea) {
                            questionToggle.classList.add('expanded');
                            inputArea.classList.add('expanded');
                        }
                    }
                });
            }

            document.getElementById('shareToggle').checked = todayDiary.shared || false;
            toggleShareOptions();

            if (todayDiary.shared) {
                selectedZone = todayDiary.zone || 'friends';
                document.querySelectorAll('.zone-btn').forEach(btn => {
                    btn.classList.remove('selected');
                });
                const zoneBtn = Array.from(document.querySelectorAll('.zone-btn')).find(btn => 
                    btn.textContent.includes(selectedZone === 'friends' ? 'å‹é”' : 'å…¨ä¸–ç•Œ')
                );
                if (zoneBtn) zoneBtn.classList.add('selected');

                selectedAnonymity = todayDiary.anonymity || 'real';
                document.querySelectorAll('.anonymity-btn').forEach(btn => {
                    btn.classList.remove('selected');
                });
                const anonymityBtn = Array.from(document.querySelectorAll('.anonymity-btn')).find(btn => {
                    if (selectedAnonymity === 'real') return btn.textContent.includes('å®Ÿå');
                    if (selectedAnonymity === 'nickname') return btn.textContent.includes('ãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ ');
                    if (selectedAnonymity === 'anonymous') return btn.textContent.includes('å®Œå…¨åŒ¿å');
                });
                if (anonymityBtn) anonymityBtn.classList.add('selected');

                document.getElementById('shareMood').checked = todayDiary.shareItems?.mood !== false;
                document.getElementById('shareMemorable').checked = todayDiary.shareItems?.memorable !== false;
                document.getElementById('shareSelfTalk').checked = todayDiary.shareItems?.selfTalk !== false;
                document.getElementById('shareRandom').checked = todayDiary.shareItems?.random !== false;
                document.getElementById('shareOptional').checked = todayDiary.shareItems?.optional !== false;
            }
        }

        // è³ªå•ã®ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ï¼ˆã‚¸ãƒ£ãƒ¼ãƒŠãƒªãƒ³ã‚°ã‚’å‰Šé™¤ï¼‰
        function renderQuestions() {
            renderQuestionList('quickQuestions', quickQuestions, 'quick');
            renderQuestionList('deepQuestions', deepQuestions, 'deep');
        }

        function renderQuestionList(containerId, questions, category) {
            const container = document.getElementById(containerId);
            container.innerHTML = questions.map((q, index) => {
                const isFavorite = favorites.some(f => f.question === q && f.category === category);
                const questionId = `${category}_${index}`;
                return `
                    <div class="question-item">
                        <div class="question-toggle" onclick="toggleQuestionItem(this)">
                            <button class="favorite-btn" onclick="event.stopPropagation(); toggleFavorite('${escapeHtml(q)}', '${category}', this)">
                                ${isFavorite ? 'â­' : 'â˜†'}
                            </button>
                            <span class="question-text">${escapeHtml(q)}</span>
                            <span class="question-arrow">â–¼</span>
                        </div>
                        <div class="question-input-area">
                            <textarea id="${questionId}" data-question="${escapeHtml(q)}" placeholder="è‡ªç”±ã«æ›¸ã„ã¦ã¿ã¦ãã ã•ã„"></textarea>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // ãƒ©ãƒ³ãƒ€ãƒ è³ªå•ã®è¨­å®š
        function setRandomQuestion() {
            const today = new Date().toDateString();
            let savedQuestion = localStorage.getItem('todayRandomQuestion');
            let savedDate = localStorage.getItem('todayRandomQuestionDate');

            if (savedDate !== today) {
                const randomIndex = Math.floor(Math.random() * randomQuestionPool.length);
                savedQuestion = randomQuestionPool[randomIndex];
                localStorage.setItem('todayRandomQuestion', savedQuestion);
                localStorage.setItem('todayRandomQuestionDate', today);
            }

            document.getElementById('randomQuestionText').textContent = savedQuestion;
        }

        // ãŠæ°—ã«å…¥ã‚Šæ©Ÿèƒ½
        function toggleFavorite(question, category, buttonElement) {
            const existingIndex = favorites.findIndex(f => f.question === question && f.category === category);
            
            if (existingIndex >= 0) {
                favorites.splice(existingIndex, 1);
            } else {
                if (favorites.length >= 5) {
                    alert('ãŠæ°—ã«å…¥ã‚Šã¯æœ€å¤§5å€‹ã¾ã§ã§ã™');
                    return;
                }
                favorites.push({ question, category });
            }
            
            localStorage.setItem('favorites', JSON.stringify(favorites));
            renderQuestions();
            updateFavoriteSection();
        }

        function updateFavoriteSection() {
            const section = document.getElementById('favoriteSection');
            const list = document.getElementById('favoriteQuestionsList');
            
            if (favorites.length === 0) {
                section.style.display = 'none';
                return;
            }
            
            section.style.display = 'block';
            list.innerHTML = favorites.map((fav, index) => {
                const questionId = `fav_${index}`;
                return `
                    <div class="question-item">
                        <div class="question-toggle" onclick="toggleQuestionItem(this)">
                            <span class="question-text">${escapeHtml(fav.question)}</span>
                            <span class="question-arrow">â–¼</span>
                        </div>
                        <div class="question-input-area">
                            <textarea id="${questionId}" data-question="${escapeHtml(fav.question)}" placeholder="è‡ªç”±ã«æ›¸ã„ã¦ã¿ã¦ãã ã•ã„"></textarea>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // ã‚»ã‚¯ã‚·ãƒ§ãƒ³é–‹é–‰
        function toggleSection(header) {
            header.classList.toggle('expanded');
            const content = header.nextElementSibling;
            content.classList.toggle('expanded');
        }

        // å€‹åˆ¥è³ªå•ã®é–‹é–‰
        function toggleQuestionItem(toggleElement) {
            toggleElement.classList.toggle('expanded');
            const inputArea = toggleElement.nextElementSibling;
            inputArea.classList.toggle('expanded');
        }

        // æ°—åˆ†é¸æŠ
        function selectMood(element, mood) {
            document.querySelectorAll('.mood-tag').forEach(tag => {
                tag.classList.remove('selected');
            });
            element.classList.add('selected');
            document.getElementById('mood').value = mood;
        }

        // å…±æœ‰è¨­å®š
        function toggleShareOptions() {
            const toggle = document.getElementById('shareToggle');
            const options = document.getElementById('shareOptions');
            options.classList.toggle('visible', toggle.checked);
        }

        // ã‚¾ãƒ¼ãƒ³é¸æŠ
        function selectZone(element, zone) {
            selectedZone = zone;
            document.querySelectorAll('.zone-btn').forEach(btn => {
                btn.classList.remove('selected');
            });
            element.classList.add('selected');
        }

        // åŒ¿åæ€§é¸æŠ
        function selectAnonymity(element, anonymity) {
            selectedAnonymity = anonymity;
            document.querySelectorAll('.anonymity-btn').forEach(btn => {
                btn.classList.remove('selected');
            });
            element.classList.add('selected');
        }

        // ä»»æ„è³ªå•ã®å›ç­”ã‚’åé›†
        function collectOptionalAnswers() {
            const answers = [];
            const allTextareas = document.querySelectorAll('textarea[data-question]');
            
            allTextareas.forEach(textarea => {
                const answer = textarea.value.trim();
                if (answer) {
                    answers.push({
                        id: textarea.id,
                        question: textarea.getAttribute('data-question'),
                        answer: answer
                    });
                }
            });
            
            return answers;
        }

        // æ—¥è¨˜ä¿å­˜
        function saveDiary() {
            const mood = document.getElementById('mood').value;
            const memorable = document.getElementById('memorable').value;
            const selfTalk = document.getElementById('selfTalk').value;

            if (!mood || !memorable || !selfTalk) {
                alert('å¿…é ˆé …ç›®ï¼ˆæ°—åˆ†ãƒ»æ®‹ã—ãŸã„ã“ã¨ãƒ»è‡ªåˆ†ã«ä¸€è¨€ï¼‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }

            saveUserName();

            const optionalAnswers = collectOptionalAnswers();

            const diary = {
                id: isEditMode ? todayDiary.id : Date.now(),
                date: new Date().toISOString(),
                mood,
                memorable,
                selfTalk,
                randomQuestion: document.getElementById('randomQuestionText').textContent,
                randomAnswer: document.getElementById('randomAnswer').value,
                optionalAnswers: optionalAnswers,
                shared: document.getElementById('shareToggle').checked,
                zone: selectedZone,
                anonymity: selectedAnonymity,
                author: getAuthorName(),
                shareItems: {
                    mood: document.getElementById('shareMood').checked,
                    memorable: document.getElementById('shareMemorable').checked,
                    selfTalk: document.getElementById('shareSelfTalk').checked,
                    random: document.getElementById('shareRandom').checked,
                    optional: document.getElementById('shareOptional').checked
                }
            };

            if (isEditMode) {
                const index = diaries.findIndex(d => d.id === todayDiary.id);
                if (index >= 0) {
                    diaries[index] = diary;
                }
            } else {
                diaries.unshift(diary);
            }

            todayDiary = diary;
            localStorage.setItem('diaries', JSON.stringify(diaries));

            const successMsg = document.getElementById('successMessage');
            const successText = document.getElementById('successMessageText');
            successText.textContent = isEditMode ? 'æ—¥è¨˜ã‚’æ›´æ–°ã—ã¾ã—ãŸï¼' : 'æ—¥è¨˜ã‚’ä¿å­˜ã—ã¾ã—ãŸï¼';
            successMsg.classList.add('show');
            setTimeout(() => {
                successMsg.classList.remove('show');
            }, 3000);

            isEditMode = true;
            document.getElementById('saveBtn').textContent = 'ğŸ”„ æ›´æ–°ã™ã‚‹';

            updateFeedButton();

            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // è‘—è€…åã®å–å¾—
        function getAuthorName() {
            const userName = document.getElementById('userName').value.trim();
            
            if (selectedAnonymity === 'anonymous') {
                return 'åŒ¿å';
            } else if (selectedAnonymity === 'nickname') {
                return userName || 'ãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ ';
            } else {
                return userName || 'åå‰æœªè¨­å®š';
            }
        }

        // ä»Šæ—¥ã®æ—¥è¨˜ãƒã‚§ãƒƒã‚¯
        function checkTodayDiary() {
            const today = new Date().toDateString();
            todayDiary = diaries.find(d => new Date(d.date).toDateString() === today);
        }

        // ãƒ•ã‚£ãƒ¼ãƒ‰ãƒœã‚¿ãƒ³ã®æ›´æ–°
        function updateFeedButton() {
            const feedBtn = document.getElementById('feedNavBtn');
            if (todayDiary) {
                feedBtn.textContent = 'ã¿ã‚“ãªã®æ—¥è¨˜';
                feedBtn.disabled = false;
                feedBtn.style.opacity = '1';
            } else {
                feedBtn.textContent = 'ã¿ã‚“ãªã®æ—¥è¨˜ ğŸ”’';
                feedBtn.disabled = false;
                feedBtn.style.opacity = '0.5';
            }
        }

        // ãƒšãƒ¼ã‚¸åˆ‡ã‚Šæ›¿ãˆ
        function switchPage(page) {
            if (page === 'feed' && !todayDiary) {
                alert('ä»Šæ—¥ã®æ—¥è¨˜ã‚’æ›¸ãã¨ã€ã¿ã‚“ãªã®æ—¥è¨˜ãŒè¦‹ã‚‰ã‚Œã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™');
                return;
            }

            currentPage = page;
            
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
            
            if (page === 'write') {
                document.getElementById('writePage').classList.add('active');
                document.querySelector('.nav-btn:nth-child(1)').classList.add('active');
                document.querySelector('.save-btn-container').style.display = 'block';
            } else if (page === 'feed') {
                document.getElementById('feedPage').classList.add('active');
                document.querySelector('.nav-btn:nth-child(2)').classList.add('active');
                document.querySelector('.save-btn-container').style.display = 'none';
                renderFeed();
            }
        }

        // XSSå¯¾ç­–ã®HTMLã‚¨ã‚¹ã‚±ãƒ¼ãƒ—
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // ãƒ•ã‚£ãƒ¼ãƒ‰è¡¨ç¤º
        function renderFeed() {
            const feedContent = document.getElementById('feedContent');
            
            if (!todayDiary) {
                feedContent.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">ğŸ”’</div>
                        <div class="empty-state-text">
                            ä»Šæ—¥ã®æ—¥è¨˜ã‚’æ›¸ãã¨<br>
                            ã¿ã‚“ãªã®æ—¥è¨˜ãŒè¦‹ã‚‰ã‚Œã¾ã™
                        </div>
                    </div>
                `;
                return;
            }

            const sharedDiaries = diaries.filter(d => d.shared && d.id !== todayDiary.id);
            
            if (sharedDiaries.length === 0) {
                feedContent.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">ğŸ“</div>
                        <div class="empty-state-text">
                            ã¾ã èª°ã‚‚æ—¥è¨˜ã‚’æ›¸ã„ã¦ã„ã¾ã›ã‚“<br>
                            ã‚ãªãŸãŒæœ€åˆã®ä¸€äººã§ã™
                        </div>
                    </div>
                `;
                return;
            }

            feedContent.innerHTML = sharedDiaries.map(diary => {
                let contentHtml = '';

                const shareItems = diary.shareItems || {
                    mood: true,
                    memorable: true,
                    selfTalk: true,
                    random: true,
                    optional: true
                };

                if (shareItems.mood && diary.mood) {
                    contentHtml += `
                        <div class="feed-question">
                            <div class="feed-question-title">æ°—åˆ†</div>
                            <div class="feed-question-answer">${escapeHtml(diary.mood)}</div>
                        </div>
                    `;
                }

                if (shareItems.memorable && diary.memorable) {
                    contentHtml += `
                        <div class="feed-question">
                            <div class="feed-question-title">æ®‹ã—ãŸã„ã“ã¨</div>
                            <div class="feed-question-answer">${escapeHtml(diary.memorable)}</div>
                        </div>
                    `;
                }

                if (shareItems.selfTalk && diary.selfTalk) {
                    contentHtml += `
                        <div class="feed-question">
                            <div class="feed-question-title">è‡ªåˆ†ã«ä¸€è¨€</div>
                            <div class="feed-question-answer">${escapeHtml(diary.selfTalk)}</div>
                        </div>
                    `;
                }

                if (shareItems.random && diary.randomAnswer) {
                    contentHtml += `
                        <div class="feed-question">
                            <div class="feed-question-title">${escapeHtml(diary.randomQuestion)}</div>
                            <div class="feed-question-answer">${escapeHtml(diary.randomAnswer)}</div>
                        </div>
                    `;
                }

                if (shareItems.optional && diary.optionalAnswers && diary.optionalAnswers.length > 0) {
                    diary.optionalAnswers.forEach(item => {
                        contentHtml += `
                            <div class="feed-question">
                                <div class="feed-question-title">${escapeHtml(item.question)}</div>
                                <div class="feed-question-answer">${escapeHtml(item.answer)}</div>
                            </div>
                        `;
                    });
                }

                return `
                    <div class="feed-item">
                        <div class="feed-header">
                            <span class="feed-author">${escapeHtml(diary.author)}</span>
                            <span class="feed-date">${formatDate(diary.date)}</span>
                        </div>
                        <div class="feed-content">
                            ${contentHtml}
                        </div>
                        <div class="feed-reactions">
                            <button class="reaction-btn" onclick="sendReaction(${diary.id}, 'ã‚ã‹ã‚‹', this)">
                                ğŸ’­ ã‚ã‹ã‚‹
                            </button>
                            <button class="reaction-btn" onclick="sendReaction(${diary.id}, 'ç¬‘ã£ãŸ', this)">
                                ğŸ˜Š ç¬‘ã£ãŸ
                            </button>
                            <button class="reaction-btn" onclick="sendReaction(${diary.id}, 'ãã£ã¨å…±æ„Ÿ', this)">
                                ğŸ¤ ãã£ã¨å…±æ„Ÿ
                            </button>
                            <button class="reaction-btn" onclick="sendReaction(${diary.id}, 'å¤§ä¸ˆå¤«ãã†', this)">
                                ğŸ‘ å¤§ä¸ˆå¤«ãã†
                            </button>
                            <button class="reaction-btn" onclick="sendReaction(${diary.id}, 'ãã‚Œå¥½ã', this)">
                                â¤ï¸ ãã‚Œå¥½ã
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            const now = new Date();
            const diff = now - date;
            const hours = Math.floor(diff / (1000 * 60 * 60));
            
            if (hours < 1) {
                return 'ãŸã£ãŸä»Š';
            } else if (hours < 24) {
                return `${hours}æ™‚é–“å‰`;
            } else {
                return `${Math.floor(hours / 24)}æ—¥å‰`;
            }
        }

        // ãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³é€ä¿¡
        function sendReaction(diaryId, reaction, buttonElement) {
            if (buttonElement.classList.contains('sent')) {
                buttonElement.classList.remove('sent');
                alert('ãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’å–ã‚Šæ¶ˆã—ã¾ã—ãŸ');
            } else {
                buttonElement.parentElement.querySelectorAll('.reaction-btn').forEach(b => {
                    b.classList.remove('sent');
                });
                buttonElement.classList.add('sent');
                alert(`ã€Œ${reaction}ã€ã‚’é€ã‚Šã¾ã—ãŸ`);
            }
        }
    </script>
</body>
</html>